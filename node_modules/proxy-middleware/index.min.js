function applyViaHeader(n,e,a){if(e.via){var r=!0===e.via?require("os").hostname():e.via,t="1.1 "+r;n.via&&(t=n.via+", "+t),a.via=t}}function slashJoin(n,e){return n.length&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),e.length&&"/"===e[0]&&(e=e.substring(1)),n+"/"+e}function extend(n,e){for(var a in e)owns.call(e,a)&&(n[a]=e[a]);return n}function merge(n,e){var a={};return extend(a,n),extend(a,e),a}var owns={}.hasOwnProperty;module.exports=function(n){var e="https:"===n.protocol?"https":"http",a=require(e).request;return n=n||{},n.hostname=n.hostname,n.port=n.port,function(e,r,t){var i=e.url;if("string"==typeof n.route){var s=slashJoin(n.route,"");if(i.slice(0,s.length)!==s)return t();i=i.slice(s.length)}var l=extend({},n);l.path=slashJoin(n.pathname,i),l.method=e.method,l.headers=n.headers?merge(e.headers,n.headers):e.headers,applyViaHeader(e.headers,l,l.headers),delete l.headers.host;var o=a(l,function(e){var a=e.statusCode,i=e.headers,s=i.location;a>300&&304>a&&s.indexOf(n.href)>-1&&(i.location=s.replace(n.href,slashJoin("",slashJoin(n.route||"","")))),applyViaHeader(e.headers,l,e.headers),r.writeHead(e.statusCode,e.headers),e.on("error",function(n){t(n)}),e.pipe(r)});o.on("error",function(n){t(n)}),e.readable?e.pipe(o):o.end()}};
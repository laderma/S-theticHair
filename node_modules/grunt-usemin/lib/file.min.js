"use strict";var path=require("path"),fs=require("fs"),getBlocks=function(n){var s,e=/<!--\s*build:(\w+)(?:\(([^\)]+)\))?\s*([^\s]+)\s*-->/,t=/<!--\s*endbuild\s*-->/,r=n.replace(/\r\n/g,"\n").split(/\n/),a=!1,i=[];return r.forEach(function(n){var r=(n.match(/^\s*/)||[])[0],o=n.match(e),l=t.test(n),u=!1;o&&(a=!0,s={type:o[1],dest:o[3],startFromRoot:u,indent:r,searchPath:[],src:[],raw:[]},o[2]&&s.searchPath.push(o[2]));var c=n.match(/<!--\[[^\]]+\]>/),h=n.match(/<!\[endif\]-->/);if(a&&c&&(s.conditionalStart=c),a&&h&&(s.conditionalEnd=h),a&&l&&(s.raw.push(n),i.push(s),a=!1),a&&s){var d=n.match(/(href|src)=["']([^'"]+)["']/);if(d&&d[2]){s.src.push(d[2]);var f=n.match(/media=['"]([^'"]+)['"]/);f&&(s.media=f[1]);var g=/ defer/.test(n);if(g&&s.defer===!1||s.defer&&!g)throw new Error("Error: You are not suppose to mix deferred and non-deferred scripts in one block.");g?s.defer=!0:s.defer=!1;var p=n.match(/data-main=['"]([^'"]+)['"]/);if(p)throw new Error("require.js blocks are no more supported.")}s.raw.push(n)}}),i};module.exports=function(n){this.dir=path.dirname(n),this.name=path.basename(n),this.searchPath=[this.dir],this.content=fs.readFileSync(n).toString(),this.blocks=getBlocks(this.content)};
"use strict";function OutStream(n,e){var a=this;this.connection=n,this.minSize=e,this.buffer=new Buffer(0),this.hasSent=!1,stream.Writable.call(this),this.on("finish",function(){a.connection.readyState===a.connection.OPEN&&a.connection.socket.write(frame.createBinaryFrame(a.buffer,!a.connection.server,!a.hasSent,!0)),a.connection.outStream=null})}var util=require("util"),stream=require("stream"),frame=require("./frame");module.exports=OutStream,util.inherits(OutStream,stream.Writable),OutStream.prototype._write=function(n,e,a){var r;this.buffer=Buffer.concat([this.buffer,n],this.buffer.length+n.length),this.buffer.length>=this.minSize?(this.connection.readyState===this.connection.OPEN&&(r=frame.createBinaryFrame(this.buffer,!this.connection.server,!this.hasSent,!1),this.connection.socket.write(r,e,a)),this.buffer=new Buffer(0),this.hasSent=!0,this.connection.readyState!==this.connection.OPEN&&a()):a()};
function createHarness(e){var n=[],t=!1,r=0,i=!1,a=!1,o=!1,s=new Render,u=function(u,l,c){function d(){if(r--,this._progeny.length){var e=this._progeny.map(function(e){return function(){t=!0,s.push(e),e.run()}});n.unshift.apply(n,e)}process.nextTick(function(){return t=!1,n.length?n.shift()():(0!==r||o||(o=!0,s.close()),void(l.exit!==!1&&canExit&&!f._ok&&process.exit(1)))})}r++;var f=new Test(u,l,c);return l&&"object"==typeof l||(l=e||{}),l.exit!==!1&&onexit(function(e){f._exit(),o||(o=!0,s.close()),e||f._ok||a&&u!==a||process.exit(1)}),process.nextTick(function(){s.piped||s.pipe(createDefaultStream()),i||s.begin(),i=!0;var e=function(){t=!0,s.push(f),f.run()};return a&&u!==a?void r--:void(t||n.length?n.push(e):e())}),f.on("test",function p(e){r++,e.on("test",p),e.on("end",d)}),f.on("end",d),f};return u.only=function(e){if(a)throw new Error("there can only be one only test");return a=e,u.apply(null,arguments)},u.stream=s,u}var createDefaultStream=require("./lib/default_stream"),Render=require("./lib/render"),Test=require("./lib/test");exports=module.exports=createHarness(),exports.createHarness=createHarness,exports.Test=Test;var canEmitExit="undefined"!=typeof process&&process&&"function"==typeof process.on,canExit="undefined"!=typeof process&&process&&"function"==typeof process.exit,onexit=function(){var e=[];return canEmitExit&&process.on("exit",function(n){for(var t=0;t<e.length;t++)e[t](n)}),function(n){e.push(n)}}();
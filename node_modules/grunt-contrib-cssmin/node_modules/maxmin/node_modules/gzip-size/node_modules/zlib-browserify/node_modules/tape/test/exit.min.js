var tap=require("tap"),spawn=require("child_process").spawn;tap.test("exit ok",function(e){e.plan(2);var n=tap.createConsumer(),t=[];n.on("data",function(e){t.push(e)}),n.on("end",function(){var n=t.map(function(e){return e&&"object"==typeof e?{id:e.id,ok:e.ok,name:e.name.trim()}:e});e.same(n,["TAP version 13","array",{id:1,ok:!0,name:"should be equivalent"},{id:2,ok:!0,name:"should be equivalent"},{id:3,ok:!0,name:"should be equivalent"},{id:4,ok:!0,name:"should be equivalent"},{id:5,ok:!0,name:"should be equivalent"},"tests 5","pass  5","ok"])});var r=spawn(process.execPath,[__dirname+"/exit/ok.js"]);r.stdout.pipe(n),r.on("exit",function(n){e.equal(n,0)})}),tap.test("exit fail",function(e){e.plan(2);var n=tap.createConsumer(),t=[];n.on("data",function(e){t.push(e)}),n.on("end",function(){var n=t.map(function(e){return e&&"object"==typeof e?{id:e.id,ok:e.ok,name:e.name.trim()}:e});e.same(n,["TAP version 13","array",{id:1,ok:!0,name:"should be equivalent"},{id:2,ok:!0,name:"should be equivalent"},{id:3,ok:!0,name:"should be equivalent"},{id:4,ok:!0,name:"should be equivalent"},{id:5,ok:!1,name:"should be equivalent"},"tests 5","pass  4","fail  1"])});var r=spawn(process.execPath,[__dirname+"/exit/fail.js"]);r.stdout.pipe(n),r.on("exit",function(n){e.notEqual(n,0)})}),tap.test("too few exit",function(e){e.plan(2);var n=tap.createConsumer(),t=[];n.on("data",function(e){t.push(e)}),n.on("end",function(){var n=t.map(function(e){return e&&"object"==typeof e?{id:e.id,ok:e.ok,name:e.name.trim()}:e});e.same(n,["TAP version 13","array",{id:1,ok:!0,name:"should be equivalent"},{id:2,ok:!0,name:"should be equivalent"},{id:3,ok:!0,name:"should be equivalent"},{id:4,ok:!0,name:"should be equivalent"},{id:5,ok:!0,name:"should be equivalent"},{id:6,ok:!1,name:"plan != count"},"tests 6","pass  5","fail  1"])});var r=spawn(process.execPath,[__dirname+"/exit/too_few.js"]);r.stdout.pipe(n),r.on("exit",function(n){e.notEqual(n,0)})});
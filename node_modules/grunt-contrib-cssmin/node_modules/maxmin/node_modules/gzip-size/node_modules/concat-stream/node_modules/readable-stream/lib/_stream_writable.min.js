"use strict";function nop(){}function WriteReq(e,n,t){this.chunk=e,this.encoding=n,this.callback=t,this.next=null}function WritableState(e,n){var t=require("./_stream_duplex");e=e||{},this.objectMode=!!e.objectMode,n instanceof t&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=e.decodeStrings===!1;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(e){var n=require("./_stream_duplex");return this instanceof Writable||this instanceof n?(this._writableState=new WritableState(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),void Stream.call(this)):new Writable(e)}function writeAfterEnd(e,n){var t=new Error("write after end");e.emit("error",t),processNextTick(n,t)}function validChunk(e,n,t,r){var i=!0;if(!Buffer.isBuffer(t)&&"string"!=typeof t&&null!==t&&void 0!==t&&!n.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),processNextTick(r,a),i=!1}return i}function decodeChunk(e,n,t){return e.objectMode||e.decodeStrings===!1||"string"!=typeof n||(n=new Buffer(n,t)),n}function writeOrBuffer(e,n,t,r,i){t=decodeChunk(n,t,r),Buffer.isBuffer(t)&&(r="buffer");var a=n.objectMode?1:t.length;n.length+=a;var o=n.length<n.highWaterMark;if(o||(n.needDrain=!0),n.writing||n.corked){var s=n.lastBufferedRequest;n.lastBufferedRequest=new WriteReq(t,r,i),s?s.next=n.lastBufferedRequest:n.bufferedRequest=n.lastBufferedRequest}else doWrite(e,n,!1,a,t,r,i);return o}function doWrite(e,n,t,r,i,a,o){n.writelen=r,n.writecb=o,n.writing=!0,n.sync=!0,t?e._writev(i,n.onwrite):e._write(i,a,n.onwrite),n.sync=!1}function onwriteError(e,n,t,r,i){--n.pendingcb,t?processNextTick(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,n){var t=e._writableState,r=t.sync,i=t.writecb;if(onwriteStateUpdate(t),n)onwriteError(e,t,r,n,i);else{var a=needFinish(t);a||t.corked||t.bufferProcessing||!t.bufferedRequest||clearBuffer(e,t),r?processNextTick(afterWrite,e,t,a,i):afterWrite(e,t,a,i)}}function afterWrite(e,n,t,r){t||onwriteDrain(e,n),n.pendingcb--,r(),finishMaybe(e,n)}function onwriteDrain(e,n){0===n.length&&n.needDrain&&(n.needDrain=!1,e.emit("drain"))}function clearBuffer(e,n){n.bufferProcessing=!0;var t=n.bufferedRequest;if(e._writev&&t&&t.next){for(var r=[],i=[];t;)i.push(t.callback),r.push(t),t=t.next;n.pendingcb++,n.lastBufferedRequest=null,doWrite(e,n,!0,n.length,r,"",function(e){for(var t=0;t<i.length;t++)n.pendingcb--,i[t](e)})}else{for(;t;){var a=t.chunk,o=t.encoding,s=t.callback,u=n.objectMode?1:a.length;if(doWrite(e,n,!1,u,a,o,s),t=t.next,n.writing)break}null===t&&(n.lastBufferedRequest=null)}n.bufferedRequest=t,n.bufferProcessing=!1}function needFinish(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function prefinish(e,n){n.prefinished||(n.prefinished=!0,e.emit("prefinish"))}function finishMaybe(e,n){var t=needFinish(n);return t&&(0===n.pendingcb?(prefinish(e,n),n.finished=!0,e.emit("finish")):prefinish(e,n)),t}function endWritable(e,n,t){n.ending=!0,finishMaybe(e,n),t&&(n.finished?processNextTick(t):e.once("finish",t)),n.ended=!0}module.exports=Writable;var processNextTick=require("process-nextick-args"),Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream;!function(){try{Stream=require("stream")}catch(e){}finally{Stream||(Stream=require("events").EventEmitter)}}();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var e=this.bufferedRequest,n=[];e;)n.push(e),e=e.next;return n},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:require("util-deprecate")(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer() instead.")})}catch(e){}}(),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(e,n,t){var r=this._writableState,i=!1;return"function"==typeof n&&(t=n,n=null),Buffer.isBuffer(e)?n="buffer":n||(n=r.defaultEncoding),"function"!=typeof t&&(t=nop),r.ended?writeAfterEnd(this,t):validChunk(this,r,e,t)&&(r.pendingcb++,i=writeOrBuffer(this,r,e,n,t)),i},Writable.prototype.cork=function(){var e=this._writableState;e.corked++},Writable.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||clearBuffer(this,e))},Writable.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);this._writableState.defaultEncoding=e},Writable.prototype._write=function(e,n,t){t(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(e,n,t){var r=this._writableState;"function"==typeof e?(t=e,e=null,n=null):"function"==typeof n&&(t=n,n=null),null!==e&&void 0!==e&&this.write(e,n),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||endWritable(this,r,t)};
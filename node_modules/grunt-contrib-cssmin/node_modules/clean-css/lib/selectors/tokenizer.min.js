module.exports=function(e,n){var t=new Chunker(e,128),r=t.next(),a=/^@(font\-face|page|\-ms\-viewport|\-o\-viewport|viewport)/,i=function(e){var i,n=e.cursor,a=e.mode;if(r.length==e.cursor){if(t.isEmpty())return null;r=t.next(),e.cursor=0}if("body"==a)return i=r.indexOf("}",n),i>-1?[i,"bodyEnd"]:null;var o=r.indexOf("@",e.cursor),s="top"==a?r.indexOf("__ESCAPED_COMMENT_CLEAN_CSS",e.cursor):-1,u=r.indexOf("{",e.cursor),l=r.indexOf("}",e.cursor);return i=o,(-1==i||s>-1&&i>s)&&(i=s),(-1==i||u>-1&&i>u)&&(i=u),(-1==i||l>-1&&i>l)&&(i=l),-1!=i?s===i?[i,"escape"]:u===i?[i,"bodyStart"]:l===i?[i,"bodyEnd"]:o===i?[i,"special"]:void 0:void 0},o=function(e){var t=[];for(e=e||{cursor:0,mode:"top"};;){var s=i(e);if(!s){var u=r.substring(e.cursor);u.length>0&&(t.push(u),e.cursor+=u.length);break}var f,d,l=s[0],c=s[1];if("special"==c){var h=r.substring(l,e.cursor+"@font-face".length+1),p=0===h.indexOf("@import")||0===h.indexOf("@charset");if(p)f=r.indexOf(";",l+1),t.push(r.substring(e.cursor,f+1)),e.cursor=f+1;else{f=r.indexOf("{",l+1);var m=r.substring(e.cursor,f).trim(),g=a.test(m);d=e.mode,e.cursor=f+1,e.mode=g?"body":"block";var v=o(e);e.mode=d,t.push({block:m,body:v})}}else if("escape"==c){f=r.indexOf("__",l+1);var b=r.substring(e.cursor,f+2);t.push(b),e.cursor=f+2}else if("bodyStart"==c){var _=r.substring(e.cursor,l).trim();d=e.mode,e.cursor=l+1,e.mode="body";var y=o(e);e.mode=d,t.push({selector:_,body:y})}else if("bodyEnd"==c){if("top"==e.mode){var k=e.cursor,w="}"==r[e.cursor]?"Unexpected '}' in '"+r.substring(k-20,k+20)+"'. Ignoring.":"Unexpected content: '"+r.substring(k,l+1)+"'. Ignoring.";n.warnings.push(w),e.cursor=l+1;continue}"block"!=e.mode&&(t=r.substring(e.cursor,l)),e.cursor=l+1;break}}return t};return{process:function(){return o()}}};var Chunker=function(e,n){for(var t=[],r=0,a=e.length;a>r;){var i=r+n>a?a-1:r+n;"}"!=e[i]&&(i=e.indexOf("}",i)),-1==i&&(i=e.length-1),t.push(e.substring(r,i+1)),r=i+1}return{isEmpty:function(){return 0===t.length},next:function(){return t.shift()||""}}};
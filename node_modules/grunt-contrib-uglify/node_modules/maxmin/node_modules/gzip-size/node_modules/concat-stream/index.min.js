function ConcatStream(e,n){if(!(this instanceof ConcatStream))return new ConcatStream(e,n);"function"==typeof e&&(n=e,e={}),e||(e={});var t=e.encoding,r=!1;t?(t=String(t).toLowerCase(),("u8"===t||"uint8"===t)&&(t="uint8array")):r=!0,Writable.call(this,{objectMode:!0}),this.encoding=t,this.shouldInferEncoding=r,n&&this.on("finish",function(){n(this.getBody())}),this.body=[]}function isArrayish(e){return/Array\]$/.test(Object.prototype.toString.call(e))}function stringConcat(e){for(var n=[],r=0;r<e.length;r++){var i=e[r];"string"==typeof i?n.push(i):Buffer.isBuffer(i)?n.push(i):n.push(Buffer(i))}return Buffer.isBuffer(e[0])?(n=Buffer.concat(n),n=n.toString("utf8")):n=n.join(""),n}function bufferConcat(e){for(var n=[],t=0;t<e.length;t++){var r=e[t];Buffer.isBuffer(r)?n.push(r):"string"==typeof r||isArrayish(r)||r&&"function"==typeof r.subarray?n.push(Buffer(r)):n.push(Buffer(String(r)))}return Buffer.concat(n)}function arrayConcat(e){for(var n=[],t=0;t<e.length;t++)n.push.apply(n,e[t]);return n}function u8Concat(e){for(var n=0,t=0;t<e.length;t++)"string"==typeof e[t]&&(e[t]=Buffer(e[t])),n+=e[t].length;for(var r=new U8(n),t=0,i=0;t<e.length;t++)for(var a=e[t],o=0;o<a.length;o++)r[i++]=a[o];return r}var Writable=require("readable-stream").Writable,inherits=require("inherits");if("undefined"==typeof Uint8Array)var U8=require("typedarray").Uint8Array;else var U8=Uint8Array;module.exports=ConcatStream,inherits(ConcatStream,Writable),ConcatStream.prototype._write=function(e,n,t){this.body.push(e),t()},ConcatStream.prototype.inferEncoding=function(e){var n=void 0===e?this.body[0]:e;return Buffer.isBuffer(n)?"buffer":"undefined"!=typeof Uint8Array&&n instanceof Uint8Array?"uint8array":Array.isArray(n)?"array":"string"==typeof n?"string":"[object Object]"===Object.prototype.toString.call(n)?"object":"buffer"},ConcatStream.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?arrayConcat(this.body):"string"===this.encoding?stringConcat(this.body):"buffer"===this.encoding?bufferConcat(this.body):"uint8array"===this.encoding?u8Concat(this.body):this.body):[]};var isArray=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};
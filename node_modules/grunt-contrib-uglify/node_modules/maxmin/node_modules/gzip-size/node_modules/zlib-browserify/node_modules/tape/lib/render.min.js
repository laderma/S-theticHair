function Render(){Stream.call(this),this.readable=!0,this.count=0,this.fail=0,this.pass=0}function encodeResult(e,n){var t="";if(t+=(e.ok?"ok ":"not ok ")+n,t+=e.name?" "+e.name.replace(/\s+/g," "):"",e.skip?t+=" # SKIP":e.todo&&(t+=" # TODO"),t+="\n",!e.ok){var r="  ",i=r+"  ";t+=r+"---\n",t+=i+"operator: "+e.operator+"\n";var a=json.stringify(e.expected)||"",o=json.stringify(e.actual)||"";if(Math.max(a.length,o.length)>65?(t+=i+"expected:\n"+i+"  "+a+"\n",t+=i+"actual:\n"+i+"  "+o+"\n"):(t+=i+"expected: "+a+"\n",t+=i+"actual:   "+o+"\n"),e.at&&(t+=i+"at: "+e.at+"\n"),"error"===e.operator&&e.actual&&e.actual.stack){var s=String(e.actual.stack).split("\n");t+=i+"stack:\n",t+=i+"  "+s[0]+"\n";for(var u=1;u<s.length;u++)t+=i+s[u]+"\n"}t+=r+"...\n"}return t}var Stream=require("stream"),json="object"==typeof JSON?JSON:require("jsonify");module.exports=Render,Render.prototype=new Stream,Render.prototype.pipe=function(){return this.piped=!0,Stream.prototype.pipe.apply(this,arguments)},Render.prototype.begin=function(){this.emit("data","TAP version 13\n")},Render.prototype.push=function(e){var n=this;this.emit("data","# "+e.name+"\n"),e.on("result",function(e){return"string"==typeof e?void n.emit("data","# "+e+"\n"):(n.emit("data",encodeResult(e,n.count+1)),n.count++,void(e.ok?n.pass++:n.fail++))})},Render.prototype.close=function(){this.emit("data","\n1.."+this.count+"\n"),this.emit("data","# tests "+this.count+"\n"),this.emit("data","# pass  "+this.pass+"\n"),this.fail?this.emit("data","# fail  "+this.fail+"\n"):this.emit("data","\n# ok\n"),this.emit("end")};
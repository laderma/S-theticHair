if("function"!=typeof define)var define=require("amdefine")(module,require);define(function(e,n,t){function o(e){return function(n,t){["\n","\r\n"].forEach(e.bind(null,n,t))}}var r=e("../../lib/source-map/source-map-generator").SourceMapGenerator,i=e("../../lib/source-map/source-map-consumer").SourceMapConsumer,a=e("../../lib/source-map/source-node").SourceNode;n["test .add()"]=function(e,n){var t=new a(null,null,null);t.add("function noop() {}"),t.add(new a(null,null,null)),t.add(["function foo() {",new a(null,null,null,"return 10;"),"}"]),e["throws"](function(){t.add({})}),e["throws"](function(){t.add(function(){})})},n["test .prepend()"]=function(e,n){var t=new a(null,null,null);t.prepend("function noop() {}"),e.equal(t.children[0],"function noop() {}"),e.equal(t.children.length,1),t.prepend(new a(null,null,null)),e.equal(t.children[0],""),e.equal(t.children[1],"function noop() {}"),e.equal(t.children.length,2),t.prepend(["function foo() {",new a(null,null,null,"return 10;"),"}"]),e.equal(t.children[0],"function foo() {"),e.equal(t.children[1],"return 10;"),e.equal(t.children[2],"}"),e.equal(t.children[3],""),e.equal(t.children[4],"function noop() {}"),e.equal(t.children.length,5),e["throws"](function(){t.prepend({})}),e["throws"](function(){t.prepend(function(){})})},n["test .toString()"]=function(e,n){e.equal(new a(null,null,null,["function foo() {",new a(null,null,null,"return 10;"),"}"]).toString(),"function foo() {return 10;}")},n["test .join()"]=function(e,n){e.equal(new a(null,null,null,["a","b","c","d"]).join(", ").toString(),"a, b, c, d")},n["test .walk()"]=function(e,n){var t=new a(null,null,null,["(function () {\n","  ",new a(1,0,"a.js",["someCall()"]),";\n","  ",new a(2,0,"b.js",["if (foo) bar()"]),";\n","}());"]),r=[{str:"(function () {\n",source:null,line:null,column:null},{str:"  ",source:null,line:null,column:null},{str:"someCall()",source:"a.js",line:1,column:0},{str:";\n",source:null,line:null,column:null},{str:"  ",source:null,line:null,column:null},{str:"if (foo) bar()",source:"b.js",line:2,column:0},{str:";\n",source:null,line:null,column:null},{str:"}());",source:null,line:null,column:null}],i=0;t.walk(function(n,t){e.equal(r[i].str,n),e.equal(r[i].source,t.source),e.equal(r[i].line,t.line),e.equal(r[i].column,t.column),i++})},n["test .replaceRight"]=function(e,n){var t;t=new a(null,null,null,"hello world"),t.replaceRight(/world/,"universe"),e.equal(t.toString(),"hello universe"),t=new a(null,null,null,[new a(null,null,null,"hey sexy mama, "),new a(null,null,null,"want to kill all humans?")]),t.replaceRight(/kill all humans/,"watch Futurama"),e.equal(t.toString(),"hey sexy mama, want to watch Futurama?")},n["test .toStringWithSourceMap()"]=o(function(e,n,t){var o=new a(null,null,null,["(function () {"+t,"  ",new a(1,0,"a.js","someCall","originalCall"),new a(1,8,"a.js","()"),";"+t,"  ",new a(2,0,"b.js",["if (foo) bar()"]),";"+t,"}());"]),s=o.toStringWithSourceMap({file:"foo.js"});e.equal(s.code,["(function () {","  someCall();","  if (foo) bar();","}());"].join(t));var u=s.map,l=o.toStringWithSourceMap().map;e.ok(u instanceof r,"map instanceof SourceMapGenerator"),e.ok(l instanceof r,"mapWithoutOptions instanceof SourceMapGenerator"),l._file="foo.js",n.assertEqualMaps(e,u.toJSON(),l.toJSON()),u=new i(u.toString());var c;c=u.originalPositionFor({line:1,column:4}),e.equal(c.source,null),e.equal(c.line,null),e.equal(c.column,null),c=u.originalPositionFor({line:2,column:2}),e.equal(c.source,"a.js"),e.equal(c.line,1),e.equal(c.column,0),e.equal(c.name,"originalCall"),c=u.originalPositionFor({line:3,column:2}),e.equal(c.source,"b.js"),e.equal(c.line,2),e.equal(c.column,0),c=u.originalPositionFor({line:3,column:16}),e.equal(c.source,null),e.equal(c.line,null),e.equal(c.column,null),c=u.originalPositionFor({line:4,column:2}),e.equal(c.source,null),e.equal(c.line,null),e.equal(c.column,null)}),n["test .fromStringWithSourceMap()"]=o(function(e,n,t){var o=n.testGeneratedCode.replace(/\n/g,t),s=a.fromStringWithSourceMap(o,new i(n.testMap)),u=s.toStringWithSourceMap({file:"min.js"}),l=u.map,c=u.code;e.equal(c,o),e.ok(l instanceof r,"map instanceof SourceMapGenerator"),l=l.toJSON(),e.equal(l.version,n.testMap.version),e.equal(l.file,n.testMap.file),e.equal(l.mappings,n.testMap.mappings)}),n["test .fromStringWithSourceMap() empty map"]=o(function(e,n,t){var o=a.fromStringWithSourceMap(n.testGeneratedCode.replace(/\n/g,t),new i(n.emptyMap)),s=o.toStringWithSourceMap({file:"min.js"}),u=s.map,l=s.code;e.equal(l,n.testGeneratedCode.replace(/\n/g,t)),e.ok(u instanceof r,"map instanceof SourceMapGenerator"),u=u.toJSON(),e.equal(u.version,n.emptyMap.version),e.equal(u.file,n.emptyMap.file),e.equal(u.mappings.length,n.emptyMap.mappings.length),e.equal(u.mappings,n.emptyMap.mappings)}),n["test .fromStringWithSourceMap() complex version"]=o(function(e,n,t){var o=new a(null,null,null,["(function() {"+t,"  var Test = {};"+t,"  ",new a(1,0,"a.js","Test.A = { value: 1234 };"+t),"  ",new a(2,0,"a.js","Test.A.x = 'xyz';"),t,"}());"+t,"/* Generated Source */"]);o=o.toStringWithSourceMap({file:"foo.js"});var s=a.fromStringWithSourceMap(o.code,new i(o.map.toString())),u=s.toStringWithSourceMap({file:"foo.js"}),l=u.map,c=u.code;e.equal(c,o.code),e.ok(l instanceof r,"map instanceof SourceMapGenerator"),l=l.toJSON();var f=o.map.toJSON();n.assertEqualMaps(e,l,f)}),n["test .toStringWithSourceMap() merging duplicate mappings"]=o(function(e,n,t){var i=new a(null,null,null,[new a(1,0,"a.js","(function"),new a(1,0,"a.js","() {"+t),"  ",new a(1,0,"a.js","var Test = "),new a(1,0,"b.js","{};"+t),new a(2,0,"b.js","Test"),new a(2,0,"b.js",".A","A"),new a(2,20,"b.js"," = { value: ","A"),"1234",new a(2,40,"b.js"," };"+t,"A"),"}());"+t,"/* Generated Source */"]);i=i.toStringWithSourceMap({file:"foo.js"}),e.equal(i.code,["(function() {","  var Test = {};","Test.A = { value: 1234 };","}());","/* Generated Source */"].join(t));var o=new r({file:"foo.js"});o.addMapping({generated:{line:1,column:0},source:"a.js",original:{line:1,column:0}}),o.addMapping({generated:{line:2,column:2},source:"a.js",original:{line:1,column:0}}),o.addMapping({generated:{line:2,column:13},source:"b.js",original:{line:1,column:0}}),o.addMapping({generated:{line:3,column:0},source:"b.js",original:{line:2,column:0}}),o.addMapping({generated:{line:3,column:4},source:"b.js",name:"A",original:{line:2,column:0}}),o.addMapping({generated:{line:3,column:6},source:"b.js",name:"A",original:{line:2,column:20}}),o.addMapping({generated:{line:3,column:18}}),o.addMapping({generated:{line:3,column:22},source:"b.js",name:"A",original:{line:2,column:40}});var s=i.map.toJSON();o=o.toJSON(),n.assertEqualMaps(e,s,o)}),n["test .toStringWithSourceMap() multi-line SourceNodes"]=o(function(e,n,t){var i=new a(null,null,null,[new a(1,0,"a.js","(function() {"+t+"var nextLine = 1;"+t+"anotherLine();"+t),new a(2,2,"b.js","Test.call(this, 123);"+t),new a(2,2,"b.js","this['stuff'] = 'v';"+t),new a(2,2,"b.js","anotherLine();"+t),"/*"+t+"Generated"+t+"Source"+t+"*/"+t,new a(3,4,"c.js","anotherLine();"+t),"/*"+t+"Generated"+t+"Source"+t+"*/"]);i=i.toStringWithSourceMap({file:"foo.js"}),e.equal(i.code,["(function() {","var nextLine = 1;","anotherLine();","Test.call(this, 123);","this['stuff'] = 'v';","anotherLine();","/*","Generated","Source","*/","anotherLine();","/*","Generated","Source","*/"].join(t));var o=new r({file:"foo.js"});o.addMapping({generated:{line:1,column:0},source:"a.js",original:{line:1,column:0}}),o.addMapping({generated:{line:2,column:0},source:"a.js",original:{line:1,column:0}}),o.addMapping({generated:{line:3,column:0},source:"a.js",original:{line:1,column:0}}),o.addMapping({generated:{line:4,column:0},source:"b.js",original:{line:2,column:2}}),o.addMapping({generated:{line:5,column:0},source:"b.js",original:{line:2,column:2}}),o.addMapping({generated:{line:6,column:0},source:"b.js",original:{line:2,column:2}}),o.addMapping({generated:{line:11,column:0},source:"c.js",original:{line:3,column:4}});var s=i.map.toJSON();o=o.toJSON(),n.assertEqualMaps(e,s,o)}),n["test .toStringWithSourceMap() with empty string"]=function(e,n){var t=new a(1,0,"empty.js",""),r=t.toStringWithSourceMap();e.equal(r.code,"")},n["test setSourceContent with toStringWithSourceMap"]=function(e,n){var t=new a(1,1,"a.js","a");t.setSourceContent("a.js","someContent");var o=new a(null,null,null,["(function () {\n","  ",t,"  ",new a(1,1,"b.js","b"),"}());"]);o.setSourceContent("b.js","otherContent");var s=o.toStringWithSourceMap({file:"foo.js"}).map;e.ok(s instanceof r,"map instanceof SourceMapGenerator"),s=new i(s.toString()),e.equal(s.sources.length,2),e.equal(s.sources[0],"a.js"),e.equal(s.sources[1],"b.js"),e.equal(s.sourcesContent.length,2),e.equal(s.sourcesContent[0],"someContent"),e.equal(s.sourcesContent[1],"otherContent")},n["test walkSourceContents"]=function(e,n){var t=new a(1,1,"a.js","a");t.setSourceContent("a.js","someContent");var r=new a(null,null,null,["(function () {\n","  ",t,"  ",new a(1,1,"b.js","b"),"}());"]);r.setSourceContent("b.js","otherContent");var i=[];r.walkSourceContents(function(e,n){i.push([e,n])}),e.equal(i.length,2),e.equal(i[0][0],"a.js"),e.equal(i[0][1],"someContent"),e.equal(i[1][0],"b.js"),e.equal(i[1][1],"otherContent")}});
var mkdirp=require("../").mkdirp,path=require("path"),fs=require("fs"),test=require("tap").test;test("race",function(n){function s(e,t){mkdirp(e,493,function(r){r?n.fail(r):path.exists(e,function(r){r?fs.stat(e,function(e,r){e?n.fail(e):(n.equal(511&r.mode,493),n.ok(r.isDirectory(),"target not a directory"),t&&t())}):n.fail("file not created")})})}n.plan(4);for(var e=["","tmp"],t=0;25>t;t++){var r=Math.floor(Math.random()*Math.pow(16,4)).toString(16);e.push(r)}var a=e.join("/"),i=2;s(a,function(){0===--i&&n.end()}),s(a,function(){0===--i&&n.end()})});
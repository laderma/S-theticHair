var fs=require("fs"),test=require("tap").test,glob=require("../");test("mock fs",function(n){function i(n){var e;switch(n.toLowerCase()){case"/tmp":case"/tmp/":e={isDirectory:function(){return!0}};break;case"/tmp/a":e={isDirectory:function(){return!1}}}return e}function s(n){var e;switch(n.toLowerCase()){case"/tmp":case"/tmp/":e=["a","A"];break;case"/":e=["tmp","tMp","tMP","TMP"]}return e}var e=fs.stat,t=fs.statSync,r=fs.readdir,a=fs.readdirSync;fs.stat=function(n,t){var r=i(n);r?process.nextTick(function(){t(null,r)}):e.call(fs,n,t)},fs.statSync=function(n){return i(n)||t.call(fs,n)},fs.readdir=function(n,e){var t=s(n);t?process.nextTick(function(){e(null,t)}):r.call(fs,n,e)},fs.readdirSync=function(n){return s(n)||a.call(fs,n)},n.pass("mocked"),n.end()}),test("nocase, nomagic",function(n){var e=2,t=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/a",{nocase:!0},function(r,a){if(r)throw r;n.same(a.sort(),t),0===--e&&n.end()}),glob("/tmp/A",{nocase:!0},function(r,a){if(r)throw r;n.same(a.sort(),t),0===--e&&n.end()})}),test("nocase, with some magic",function(n){n.plan(2);var e=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/*",{nocase:!0},function(t,r){if(t)throw t;n.same(r.sort(),e)}),glob("/tmp/*",{nocase:!0},function(t,r){if(t)throw t;n.same(r.sort(),e)})});
var test=require("tap").test,LRU=require("../");test("forEach",function(e){for(var n=new LRU(5),t=0;10>t;t++)n.set(t.toString(),t.toString(2));var t=9;n.forEach(function(r,i,a){e.equal(a,n),e.equal(i,t.toString()),e.equal(r,t.toString(2)),t-=1}),n.get(6),n.get(8);var r=[8,6,9,7,5],t=0;n.forEach(function(i,a,o){var s=r[t++];e.equal(o,n),e.equal(a,s.toString()),e.equal(i,s.toString(2))}),e.equal(t,r.length),e.end()}),test("keys() and values()",function(e){for(var n=new LRU(5),t=0;10>t;t++)n.set(t.toString(),t.toString(2));e.similar(n.keys(),["9","8","7","6","5"]),e.similar(n.values(),["1001","1000","111","110","101"]),n.get(6),n.get(8),e.similar(n.keys(),["8","6","9","7","5"]),e.similar(n.values(),["1000","110","1001","111","101"]),e.end()}),test("all entries are iterated over",function(e){for(var n=new LRU(5),t=0;10>t;t++)n.set(t.toString(),t.toString(2));var t=0;n.forEach(function(e,n,r){t>0&&r.del(n),t+=1}),e.equal(t,5),e.equal(n.keys().length,1),e.end()}),test("all stale entries are removed",function(e){for(var n=new LRU({max:5,maxAge:-5,stale:!0}),t=0;10>t;t++)n.set(t.toString(),t.toString(2));var t=0;n.forEach(function(){t+=1}),e.equal(t,5),e.equal(n.keys().length,0),e.end()}),test("expires",function(e){for(var n=new LRU({max:10,maxAge:50}),t=0;10>t;t++)n.set(t.toString(),t.toString(2),t%2?25:void 0);var t=0,r=[8,6,4,2,0];setTimeout(function(){n.forEach(function(i,a,o){var s=r[t++];e.equal(o,n),e.equal(a,s.toString()),e.equal(i,s.toString(2))}),e.equal(t,r.length),setTimeout(function(){var t=0;n.forEach(function(e,n,r){t++}),e.equal(0,t),e.end()},25)},26)});
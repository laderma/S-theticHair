function headersSent(){return Boolean(this._header)}function unique(e,n){for(var t=[],r=0;r<n.length;r++)-1===e.indexOf(n[r])&&t.push(n[r]);return t}var cookie=require("cookie"),deprecate=require("depd")("connect"),http=require("http"),merge=require("utils-merge"),onHeaders=require("on-headers"),utils=require("./utils"),res=http.ServerResponse.prototype,addListener=res.addListener,setHeader=res.setHeader;res._hasConnectPatch||(Object.defineProperty(res,"headerSent",{configurable:!0,enumerable:!0,get:headersSent}),deprecate.property(res,"headerSent","res.headerSent: use standard res.headersSent"),"headersSent"in res||Object.defineProperty(res,"headersSent",{configurable:!0,enumerable:!0,get:headersSent}),res.cookie=function(e,n,t){t=merge({},t),"maxAge"in t&&(t.expires=new Date(Date.now()+t.maxAge),t.maxAge/=1e3),null==t.path&&(t.path="/"),this.setHeader("Set-Cookie",cookie.serialize(e,String(n),t))},res.appendHeader=function(e,n){var t=this.getHeader(e);return t?(n=Array.isArray(t)?t.concat(n):Array.isArray(n)?[t].concat(n):[t,n],setHeader.call(this,e,n)):setHeader.call(this,e,n)},res.setHeader=function(e,n){var r,t=e.toLowerCase();return"set-cookie"===t?(Array.isArray(n)&&n.length>1&&(r=[].concat(this.getHeader(e)||[]),n=unique(r,n)),this.appendHeader(e,n)):("content-type"==t&&this.charset&&(n=utils.setCharset(n,this.charset,!0)),setHeader.call(this,e,n))},res.on=function(e,n){return"header"===e?(deprecate('res.on("header"): use on-headers npm module instead'),onHeaders(this,n),this):addListener.apply(this,arguments)},res._hasConnectPatch=!0);
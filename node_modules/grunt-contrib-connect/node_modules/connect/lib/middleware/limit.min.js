var createError=require("http-errors"),deprecate=require("depd")("connect"),parseBytes=require("bytes"),utils=require("../utils"),brokenPause=utils.brokenPause;module.exports=function(e){if("string"==typeof e&&(e=parseBytes(e)),"number"!=typeof e)throw new Error("limit() bytes required");return function(n,t,r){function o(){n.on("data",function(t){a+=Buffer.isBuffer(t)?t.length:Buffer.byteLength(t),a>e&&n.destroy()})}var a=0,i=n.headers["content-length"]?parseInt(n.headers["content-length"],10):null;return n._limit?r():(n._limit=!0,i&&i>e?r(createError(413)):(brokenPause?o():n.on("newListener",function s(e){"data"===e&&(n.removeListener("newListener",s),process.nextTick(o))}),void r()))}},module.exports=deprecate["function"](module.exports,"limit: Restrict request size at location of read");
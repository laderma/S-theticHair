"use strict";function serveStatic(e,n){if(!e)throw new TypeError("root path required");if("string"!=typeof e)throw new TypeError("root path must be a string");var t=Object.create(n||null),r=t.fallthrough!==!1,a=t.redirect!==!1,i=t.setHeaders;if(i&&"function"!=typeof i)throw new TypeError("option setHeaders must be function");t.maxage=t.maxage||t.maxAge||0,t.root=resolve(e);var o=a?createRedirectDirectoryListener():createNotFoundDirectoryListener();return function(e,n,a){if("GET"!==e.method&&"HEAD"!==e.method)return r?a():(n.statusCode=405,n.setHeader("Allow","GET, HEAD"),n.setHeader("Content-Length","0"),void n.end());var s=!r,u=parseUrl.original(e),l=parseUrl(e).pathname;"/"===l&&"/"!==u.pathname.substr(-1)&&(l="");var c=send(e,l,t);c.on("directory",o),i&&c.on("headers",i),r&&c.on("file",function(){s=!0}),c.on("error",function(e){return!s&&e.statusCode<500?void a():void a(e)}),c.pipe(n)}}function collapseLeadingSlashes(e){for(var n=0;n<e.length&&"/"===e[n];n++);return n>1?"/"+e.substr(n):e}function createNotFoundDirectoryListener(){return function(){this.error(404)}}function createRedirectDirectoryListener(){return function(){if(this.hasTrailingSlash())return void this.error(404);var e=parseUrl.original(this.req);e.path=null,e.pathname=collapseLeadingSlashes(e.pathname+"/");var n=url.format(e),t='Redirecting to <a href="'+escapeHtml(n)+'">'+escapeHtml(n)+"</a>\n",r=this.res;r.statusCode=303,r.setHeader("Content-Type","text/html; charset=UTF-8"),r.setHeader("Content-Length",Buffer.byteLength(t)),r.setHeader("X-Content-Type-Options","nosniff"),r.setHeader("Location",n),r.end(t)}}var escapeHtml=require("escape-html"),parseUrl=require("parseurl"),resolve=require("path").resolve,send=require("send"),url=require("url");module.exports=serveStatic,module.exports.mime=send.mime;
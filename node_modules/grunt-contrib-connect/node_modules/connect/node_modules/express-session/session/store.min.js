var EventEmitter=require("events").EventEmitter,Session=require("./session"),Cookie=require("./cookie"),Store=module.exports=function(e){};Store.prototype.__proto__=EventEmitter.prototype,Store.prototype.regenerate=function(e,n){var t=this;this.destroy(e.sessionID,function(r){t.generate(e),n(r)})},Store.prototype.load=function(e,n){var t=this;this.get(e,function(r,i){if(r)return n(r);if(!i)return n();var a={sessionID:e,sessionStore:t};i=t.createSession(a,i),n(null,i)})},Store.prototype.createSession=function(e,n){var t=n.cookie.expires,r=n.cookie.originalMaxAge;return n.cookie=new Cookie(n.cookie),"string"==typeof t&&(n.cookie.expires=new Date(t)),n.cookie.originalMaxAge=r,e.session=new Session(e,n),e.session};
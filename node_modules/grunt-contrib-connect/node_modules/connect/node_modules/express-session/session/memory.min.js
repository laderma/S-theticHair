function MemoryStore(){Store.call(this),this.sessions=Object.create(null)}function getSession(e){var n=this.sessions[e];if(n){n=JSON.parse(n);var t="string"==typeof n.cookie.expires?new Date(n.cookie.expires):n.cookie.expires;return t&&t<=Date.now()?void delete this.sessions[e]:n}}var Store=require("./store"),util=require("util"),defer="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};module.exports=MemoryStore,util.inherits(MemoryStore,Store),MemoryStore.prototype.all=function(e){for(var n=Object.keys(this.sessions),t=Object.create(null),r=0;r<n.length;r++){var i=n[r],a=getSession.call(this,i);a&&(t[i]=a)}e&&defer(e,null,t)},MemoryStore.prototype.clear=function(e){this.sessions=Object.create(null),e&&defer(e)},MemoryStore.prototype.destroy=function(e,n){delete this.sessions[e],n&&defer(n)},MemoryStore.prototype.get=function(e,n){defer(n,null,getSession.call(this,e))},MemoryStore.prototype.length=function(e){this.all(function(n,t){return n?e(n):void e(null,Object.keys(t).length)})},MemoryStore.prototype.set=function(e,n,t){this.sessions[e]=JSON.stringify(n),t&&defer(t)},MemoryStore.prototype.touch=function(e,n,t){var r=getSession.call(this,e);r&&(r.cookie=n.cookie,this.sessions[e]=JSON.stringify(r)),t&&defer(t)};
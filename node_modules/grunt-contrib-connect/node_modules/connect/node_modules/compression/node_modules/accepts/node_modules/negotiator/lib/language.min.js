function parseAcceptLanguage(e){for(var n=e.split(","),t=0,r=0;t<n.length;t++){var i=parseLanguage(n[t].trim(),t);i&&(n[r++]=i)}return n.length=r,n}function parseLanguage(e,n){var t=e.match(/^\s*(\S+?)(?:-(\S+?))?\s*(?:;(.*))?$/);if(!t)return null;var r=t[1],i=t[2],a=r;i&&(a+="-"+i);var o=1;if(t[3])for(var s=t[3].split(";"),n=0;n<s.length;n++){var u=s[n].split("=");"q"===u[0]&&(o=parseFloat(u[1]))}return{prefix:r,suffix:i,q:o,i:n,full:a}}function getLanguagePriority(e,n,t){for(var r={o:-1,q:0,s:0},i=0;i<n.length;i++){var a=specify(e,n[i],t);a&&(r.s-a.s||r.q-a.q||r.o-a.o)<0&&(r=a)}return r}function specify(e,n,t){var r=parseLanguage(e);if(!r)return null;var i=0;if(n.full.toLowerCase()===r.full.toLowerCase())i|=4;else if(n.prefix.toLowerCase()===r.full.toLowerCase())i|=2;else if(n.full.toLowerCase()===r.prefix.toLowerCase())i|=1;else if("*"!==n.full)return null;return{i:t,o:n.i,q:n.q,s:i}}function preferredLanguages(e,n){var t=parseAcceptLanguage(void 0===e?"*":e||"");if(!n)return t.filter(isQuality).sort(compareSpecs).map(function(e){return e.full});var r=n.map(function(e,n){return getLanguagePriority(e,t,n)});return r.filter(isQuality).sort(compareSpecs).map(function(e){return n[r.indexOf(e)]})}function compareSpecs(e,n){return n.q-e.q||n.s-e.s||e.o-n.o||e.i-n.i||0}function isQuality(e){return e.q>0}module.exports=preferredLanguages,preferredLanguages.preferredLanguages=preferredLanguages;
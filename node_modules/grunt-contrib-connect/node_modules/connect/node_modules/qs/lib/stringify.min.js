var Utils=require("./utils"),internals={delimiter:"&",arrayPrefixGenerators:{brackets:function(e,n){return e+"[]"},indices:function(e,n){return e+"["+n+"]"},repeat:function(e,n){return e}},strictNullHandling:!1};internals.stringify=function(e,n,t,r,i){if("function"==typeof i)e=i(n,e);else if(Utils.isBuffer(e))e=e.toString();else if(e instanceof Date)e=e.toISOString();else if(null===e){if(r)return Utils.encode(n);e=""}if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return[Utils.encode(n)+"="+Utils.encode(e)];var a=[];if("undefined"==typeof e)return a;for(var o=Array.isArray(i)?i:Object.keys(e),s=0,l=o.length;l>s;++s){var u=o[s];a=Array.isArray(e)?a.concat(internals.stringify(e[u],t(n,u),t,r,i)):a.concat(internals.stringify(e[u],n+"["+u+"]",t,r,i))}return a},module.exports=function(e,n){n=n||{};var i,a,t="undefined"==typeof n.delimiter?internals.delimiter:n.delimiter,r="boolean"==typeof n.strictNullHandling?n.strictNullHandling:internals.strictNullHandling;"function"==typeof n.filter?(a=n.filter,e=a("",e)):Array.isArray(n.filter)&&(i=a=n.filter);var o=[];if("object"!=typeof e||null===e)return"";var s;s=n.arrayFormat in internals.arrayPrefixGenerators?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var l=internals.arrayPrefixGenerators[s];i||(i=Object.keys(e));for(var u=0,c=i.length;c>u;++u){var f=i[u];o=o.concat(internals.stringify(e[f],f,l,r,a))}return o.join(t)};
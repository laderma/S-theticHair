"use strict";function Utf7Codec(e,n){this.iconv=n}function Utf7Encoder(e,n){this.iconv=n.iconv}function Utf7Decoder(e,n){this.iconv=n.iconv,this.inBase64=!1,this.base64Accum=""}function Utf7IMAPCodec(e,n){this.iconv=n}function Utf7IMAPEncoder(e,n){this.iconv=n.iconv,this.inBase64=!1,this.base64Accum=new Buffer(6),this.base64AccumIdx=0}function Utf7IMAPDecoder(e,n){this.iconv=n.iconv,this.inBase64=!1,this.base64Accum=""}exports.utf7=Utf7Codec,exports.unicode11utf7="utf7",Utf7Codec.prototype.encoder=Utf7Encoder,Utf7Codec.prototype.decoder=Utf7Decoder,Utf7Codec.prototype.bomAware=!0;var nonDirectChars=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;Utf7Encoder.prototype.write=function(e){return new Buffer(e.replace(nonDirectChars,function(e){return"+"+("+"===e?"":this.iconv.encode(e,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))},Utf7Encoder.prototype.end=function(){};for(var base64Regex=/[A-Za-z0-9\/+]/,base64Chars=[],i=0;256>i;i++)base64Chars[i]=base64Regex.test(String.fromCharCode(i));var plusChar="+".charCodeAt(0),minusChar="-".charCodeAt(0),andChar="&".charCodeAt(0);Utf7Decoder.prototype.write=function(e){for(var n="",t=0,r=this.inBase64,i=this.base64Accum,a=0;a<e.length;a++)if(r){if(!base64Chars[e[a]]){if(a==t&&e[a]==minusChar)n+="+";else{var o=i+e.slice(t,a).toString();n+=this.iconv.decode(new Buffer(o,"base64"),"utf16-be")}e[a]!=minusChar&&a--,t=a+1,r=!1,i=""}}else e[a]==plusChar&&(n+=this.iconv.decode(e.slice(t,a),"ascii"),t=a+1,r=!0);if(r){var o=i+e.slice(t).toString(),s=o.length-o.length%8;i=o.slice(s),o=o.slice(0,s),n+=this.iconv.decode(new Buffer(o,"base64"),"utf16-be")}else n+=this.iconv.decode(e.slice(t),"ascii");return this.inBase64=r,this.base64Accum=i,n},Utf7Decoder.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e},exports.utf7imap=Utf7IMAPCodec,Utf7IMAPCodec.prototype.encoder=Utf7IMAPEncoder,Utf7IMAPCodec.prototype.decoder=Utf7IMAPDecoder,Utf7IMAPCodec.prototype.bomAware=!0,Utf7IMAPEncoder.prototype.write=function(e){for(var n=this.inBase64,t=this.base64Accum,r=this.base64AccumIdx,i=new Buffer(5*e.length+10),a=0,o=0;o<e.length;o++){var s=e.charCodeAt(o);s>=32&&126>=s?(n&&(r>0&&(a+=i.write(t.slice(0,r).toString("base64").replace(/\//g,",").replace(/=+$/,""),a),r=0),i[a++]=minusChar,n=!1),n||(i[a++]=s,s===andChar&&(i[a++]=minusChar))):(n||(i[a++]=andChar,n=!0),n&&(t[r++]=s>>8,t[r++]=255&s,r==t.length&&(a+=i.write(t.toString("base64").replace(/\//g,","),a),r=0)))}return this.inBase64=n,this.base64AccumIdx=r,i.slice(0,a)},Utf7IMAPEncoder.prototype.end=function(){var e=new Buffer(10),n=0;return this.inBase64&&(this.base64AccumIdx>0&&(n+=e.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),n),this.base64AccumIdx=0),e[n++]=minusChar,this.inBase64=!1),e.slice(0,n)};var base64IMAPChars=base64Chars.slice();base64IMAPChars[",".charCodeAt(0)]=!0,Utf7IMAPDecoder.prototype.write=function(e){for(var n="",t=0,r=this.inBase64,i=this.base64Accum,a=0;a<e.length;a++)if(r){if(!base64IMAPChars[e[a]]){if(a==t&&e[a]==minusChar)n+="&";else{var o=i+e.slice(t,a).toString().replace(/,/g,"/");n+=this.iconv.decode(new Buffer(o,"base64"),"utf16-be")}e[a]!=minusChar&&a--,t=a+1,r=!1,i=""}}else e[a]==andChar&&(n+=this.iconv.decode(e.slice(t,a),"ascii"),t=a+1,r=!0);if(r){var o=i+e.slice(t).toString().replace(/,/g,"/"),s=o.length-o.length%8;i=o.slice(s),o=o.slice(0,s),n+=this.iconv.decode(new Buffer(o,"base64"),"utf16-be")}else n+=this.iconv.decode(e.slice(t),"ascii");return this.inBase64=r,this.base64Accum=i,n},Utf7IMAPDecoder.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e};
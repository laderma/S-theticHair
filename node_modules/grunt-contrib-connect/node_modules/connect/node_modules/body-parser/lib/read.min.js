"use strict";function read(e,n,t,r,i,a){var o,s;e._body=!0;var l=a||{};try{s=contentstream(e,i,l.inflate),o=s.length,s.length=void 0}catch(u){return t(u)}l.length=o;var c=null!==l.encoding?l.encoding||"utf-8":null,f=l.verify;l.encoding=f?null:c,i("read body"),getBody(s,l,function(a,o){if(a)return setErrorStatus(a,400),"encoding.unsupported"===a.type&&(a=createError(415,'unsupported charset "'+c.toUpperCase()+'"',{charset:c.toLowerCase()})),s.resume(),void onFinished(e,function(){t(a)});if(f)try{i("verify body"),f(e,n,o,c)}catch(a){return setErrorStatus(a,403),void t(a)}var l;try{i("parse body"),l="string"!=typeof o&&null!==c?iconv.decode(o,c):o,e.body=r(l)}catch(a){return a.body=void 0===l?o:l,setErrorStatus(a,400),void t(a)}t()})}function contentstream(e,n,t){var a,r=(e.headers["content-encoding"]||"identity").toLowerCase(),i=e.headers["content-length"];if(n('content-encoding "%s"',r),t===!1&&"identity"!==r)throw createError(415,"content encoding unsupported");switch(r){case"deflate":a=zlib.createInflate(),n("inflate body"),e.pipe(a);break;case"gzip":a=zlib.createGunzip(),n("gunzip body"),e.pipe(a);break;case"identity":a=e,a.length=i;break;default:throw createError(415,'unsupported content encoding "'+r+'"',{encoding:r})}return a}function setErrorStatus(e,n){e.status||e.statusCode||(e.status=n,e.statusCode=n)}var createError=require("http-errors"),getBody=require("raw-body"),iconv=require("iconv-lite"),onFinished=require("on-finished"),zlib=require("zlib");module.exports=read;
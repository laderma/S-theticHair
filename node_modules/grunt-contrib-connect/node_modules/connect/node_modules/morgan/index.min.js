"use strict";function morgan(e,n){var t=e,r=n||{};e&&"object"==typeof e&&(r=e,t=r.format||"default",deprecate("morgan(options): use morgan("+("string"==typeof t?JSON.stringify(t):"format")+", options) instead")),void 0===t&&deprecate("undefined format: specify a format");var a=r.immediate,i=r.skip||!1,o="function"!=typeof t?getFormatFunction(t):t,s=r.buffer,u=r.stream||process.stdout;if(s){deprecate("buffer option");var l="number"!=typeof s?defaultBufferDuration:s;u=createBufferStream(u,l)}return function(e,n,t){function r(){if(i!==!1&&i(e,n))return void debug("skip request");var t=o(morgan,e,n);return null==t?void debug("skip line"):(debug("log request"),void u.write(t+"\n"))}e._startAt=void 0,e._startTime=void 0,e._remoteAddress=getip(e),n._startAt=void 0,n._startTime=void 0,recordStartTime.call(e),a?r():(onHeaders(n,recordStartTime),onFinished(n,r)),t()}}function clfdate(e){var n=e.getUTCDate(),t=e.getUTCHours(),r=e.getUTCMinutes(),a=e.getUTCSeconds(),i=e.getUTCFullYear(),o=clfmonth[e.getUTCMonth()];return pad2(n)+"/"+o+"/"+i+":"+pad2(t)+":"+pad2(r)+":"+pad2(a)+" +0000"}function compile(e){if("string"!=typeof e)throw new TypeError("argument format must be a string");var n=e.replace(/"/g,'\\"'),t='  return "'+n.replace(/:([-\w]{2,})(?:\[([^\]]+)\])?/g,function(e,n,t){return'"\n    + (tokens["'+n+'"](req, res, '+String(JSON.stringify(t))+') || "-") + "'})+'";';return new Function("tokens, req, res",t)}function createBufferStream(e,n){function a(){r=null,e.write(t.join("")),t.length=0}function i(e){null===r&&(r=setTimeout(a,n)),t.push(e)}var t=[],r=null;return{write:i}}function format(e,n){return morgan[e]=n,this}function getFormatFunction(e){var n=morgan[e]||e||morgan["default"];return"function"!=typeof n?compile(n):n}function getip(e){return e.ip||e._remoteAddress||e.connection&&e.connection.remoteAddress||void 0}function pad2(e){var n=String(e);return(1===n.length?"0":"")+n}function recordStartTime(){this._startAt=process.hrtime(),this._startTime=new Date}function token(e,n){return morgan[e]=n,this}module.exports=morgan,module.exports.compile=compile,module.exports.format=format,module.exports.token=token;var auth=require("basic-auth"),debug=require("debug")("morgan"),deprecate=require("depd")("morgan"),onFinished=require("on-finished"),onHeaders=require("on-headers"),clfmonth=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],defaultBufferDuration=1e3;morgan.format("combined",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),morgan.format("common",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length]'),morgan.format("default",':remote-addr - :remote-user [:date] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),deprecate.property(morgan,"default","default format: use combined format"),morgan.format("short",":remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms"),morgan.format("tiny",":method :url :status :res[content-length] - :response-time ms"),morgan.format("dev",function e(n,t,r){var a=r._header?r.statusCode:void 0,i=a>=500?31:a>=400?33:a>=300?36:a>=200?32:0,o=e[i];return o||(o=e[i]=compile("[0m:method :url ["+i+"m:status [0m:response-time ms - :res[content-length][0m")),o(n,t,r)}),morgan.token("url",function(e){return e.originalUrl||e.url}),morgan.token("method",function(e){return e.method}),morgan.token("response-time",function(e,n){if(e._startAt&&n._startAt){var t=1e3*(n._startAt[0]-e._startAt[0])+1e-6*(n._startAt[1]-e._startAt[1]);return t.toFixed(3)}}),morgan.token("date",function(e,n,t){var r=new Date;switch(t||"web"){case"clf":return clfdate(r);case"iso":return r.toISOString();case"web":return r.toUTCString()}}),morgan.token("status",function(e,n){return n._header?String(n.statusCode):void 0}),morgan.token("referrer",function(e){return e.headers.referer||e.headers.referrer}),morgan.token("remote-addr",getip),morgan.token("remote-user",function(e){var n=auth(e);return n?n.name:void 0}),morgan.token("http-version",function(e){return e.httpVersionMajor+"."+e.httpVersionMinor}),morgan.token("user-agent",function(e){return e.headers["user-agent"]}),morgan.token("req",function(e,n,t){var r=e.headers[t.toLowerCase()];return Array.isArray(r)?r.join(", "):r}),morgan.token("res",function(e,n,t){if(!n._header)return void 0;var r=n.getHeader(t);return Array.isArray(r)?r.join(", "):r});
function noop(){}function Batch(){if(!(this instanceof Batch))return new Batch;this.fns=[],this.concurrency(1/0),this["throws"](!0);for(var e=0,n=arguments.length;n>e;++e)this.push(arguments[e])}try{var EventEmitter=require("events").EventEmitter}catch(err){var Emitter=require("emitter")}module.exports=Batch,EventEmitter?Batch.prototype.__proto__=EventEmitter.prototype:Emitter(Batch.prototype),Batch.prototype.concurrency=function(e){return this.n=e,this},Batch.prototype.push=function(e){return this.fns.push(e),this},Batch.prototype["throws"]=function(e){return this.e=!!e,this},Batch.prototype.end=function(e){function f(){function m(o,l){if(!c){if(o&&u)return c=!0,e(o);var d=t-r+1,h=new Date;i[s]=l,a[s]=o,n.emit("progress",{index:s,value:l,error:o,pending:r,total:t,complete:d,percent:d/t*100|0,start:p,end:h,duration:h-p}),--r?f():u?e(null,i):e(a,i)}}var s=l++,d=o[s];if(d){var p=new Date;try{d(m)}catch(h){m(h)}}}var c,n=this,t=this.fns.length,r=t,i=[],a=[],e=e||noop,o=this.fns,s=this.n,u=this.e,l=0;if(!o.length)return e(null,i);for(var d=0;d<o.length&&d!=s;d++)f();return this};
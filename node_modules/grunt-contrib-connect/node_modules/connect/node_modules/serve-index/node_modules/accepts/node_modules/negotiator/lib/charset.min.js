function parseAcceptCharset(e){for(var n=e.split(","),t=0,r=0;t<n.length;t++){var i=parseCharset(n[t].trim(),t);i&&(n[r++]=i)}return n.length=r,n}function parseCharset(e,n){var t=e.match(/^\s*(\S+?)\s*(?:;(.*))?$/);if(!t)return null;var r=t[1],i=1;if(t[2])for(var a=t[2].split(";"),n=0;n<a.length;n++){var o=a[n].trim().split("=");if("q"===o[0]){i=parseFloat(o[1]);break}}return{charset:r,q:i,i:n}}function getCharsetPriority(e,n,t){for(var r={o:-1,q:0,s:0},i=0;i<n.length;i++){var a=specify(e,n[i],t);a&&(r.s-a.s||r.q-a.q||r.o-a.o)<0&&(r=a)}return r}function specify(e,n,t){var r=0;if(n.charset.toLowerCase()===e.toLowerCase())r|=1;else if("*"!==n.charset)return null;return{i:t,o:n.i,q:n.q,s:r}}function preferredCharsets(e,n){var t=parseAcceptCharset(void 0===e?"*":e||"");if(!n)return t.filter(isQuality).sort(compareSpecs).map(function(e){return e.charset});var r=n.map(function(e,n){return getCharsetPriority(e,t,n)});return r.filter(isQuality).sort(compareSpecs).map(function(e){return n[r.indexOf(e)]})}function compareSpecs(e,n){return n.q-e.q||n.s-e.s||e.o-n.o||e.i-n.i||0}function isQuality(e){return e.q>0}module.exports=preferredCharsets,preferredCharsets.preferredCharsets=preferredCharsets;
function findAPortWithStatus(e,n,t,r,a){t=t||65535;var i=!1,s=0,o=n,l=function(){return i||s===t-n+1},u=function(n){portscanner.checkPortStatus(o,r,function(t,r){s++,r===e?(i=!0,n(t)):(o++,n(null))})};async.until(l,u,function(e){e?a(e,o):i?a(null,o):a(null,!1)})}var net=require("net"),Socket=net.Socket,async=require("async"),portscanner=exports;portscanner.findAPortInUse=function(e,n,t,r){findAPortWithStatus("open",e,n,t,r)},portscanner.findAPortNotInUse=function(e,n,t,r){findAPortWithStatus("closed",e,n,t,r)},portscanner.checkPortStatus=function(e,n,t){"string"==typeof n&&(n={host:n});var r=n.host||"127.0.0.1",a=n.timeout||400,i=!1,s=new Socket,o=null,l=null;s.on("connect",function(){o="open",s.destroy()}),s.setTimeout(a),s.on("timeout",function(){o="closed",l=new Error("Timeout ("+a+"ms) occurred waiting for "+r+":"+e+" to be available"),s.destroy()}),s.on("error",function(e){"ECONNREFUSED"!==e.code?l=e:i=!0,o="closed"}),s.on("close",function(e){l=e&&!i?e:null,t(l,o)}),s.connect(e,r)};
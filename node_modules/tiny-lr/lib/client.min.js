function Client(e,n,t,r){r=this.options=r||{},this.ws=new WebSocket(e,n,t),this.ws.onmessage=this.message.bind(this),this.ws.onclose=this.close.bind(this),this.id=this.uniqueId("ws")}var util=require("util"),events=require("events"),WebSocket=require("faye-websocket");module.exports=Client,util.inherits(Client,events.EventEmitter),Client.prototype.message=function(e){var n=this.data(e);return this[n.command]?this[n.command](n):void 0},Client.prototype.close=function(e){this.ws&&(this.ws.close(),this.ws=null),this.emit("end",e)},Client.prototype.hello=function(){this.send({command:"hello",protocols:["http://livereload.com/protocols/official-7"],serverName:"tiny-lr"})},Client.prototype.info=function(e){this.plugins=e.plugins,this.url=e.url},Client.prototype.reload=function(e){e.forEach(function(e){this.send({command:"reload",path:e,liveCSS:this.options.liveCSS!==!1,liveJs:this.options.liveJs!==!1,liveImg:this.options.liveImg!==!1})},this)},Client.prototype.data=function(e){var n={};try{n=JSON.parse(e.data)}catch(t){}return n},Client.prototype.send=function(e){this.ws.send(JSON.stringify(e))};var idCounter=0;Client.prototype.uniqueId=function(e){var n=idCounter++;return e?e+n:n};
var WebSocket=require("../lib/faye/websocket"),pace=require("pace"),host="ws://localhost:9001",agent="Node "+process.version,cases=0,skip=[],socket=new WebSocket.Client(host+"/getCaseCount"),progress;socket.onmessage=function(e){console.log("Total cases to run: "+e.data),cases=parseInt(e.data),progress=pace(cases)},socket.onclose=function(){var e=function(n){progress.op(),n>cases?(socket=new WebSocket.Client(host+"/updateReports?agent="+encodeURIComponent(agent)),socket.onclose=process.exit):skip.indexOf(n)>=0?e(n+1):(socket=new WebSocket.Client(host+"/runCase?case="+n+"&agent="+encodeURIComponent(agent)),socket.pipe(socket),socket.on("close",function(){e(n+1)}))};e(1)};
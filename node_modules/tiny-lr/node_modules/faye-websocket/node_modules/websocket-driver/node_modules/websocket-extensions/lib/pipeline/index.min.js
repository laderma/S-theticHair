"use strict";var Cell=require("./cell"),Pledge=require("./pledge"),Pipeline=function(e){this._cells=e.map(function(e){return new Cell(e)}),this._stopped={incoming:!1,outgoing:!1}};Pipeline.prototype.processIncomingMessage=function(e,n,t){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,n,t)},Pipeline.prototype.processOutgoingMessage=function(e,n,t){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,n,t)},Pipeline.prototype.close=function(e,n){this._stopped={incoming:!0,outgoing:!0};var t=this._cells.map(function(e){return e.close()});e&&Pledge.all(t).then(function(){e.call(n)})},Pipeline.prototype._loop=function(e,n,t,r,i,a,o){for(var s=this._cells,u=s.length,l=this;u--;)s[u].pending(e);var c=function(n,i,u){return n===t?a.call(o,i,u):void s[n][e](i,u,function(t,i){t&&(l._stopped[e]=!0),c(n+r,t,i)})};c(n,null,i)},module.exports=Pipeline;
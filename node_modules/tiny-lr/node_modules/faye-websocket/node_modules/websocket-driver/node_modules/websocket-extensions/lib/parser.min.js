"use strict";var TOKEN=/([!#\$%&'\*\+\-\.\^_`\|~0-9a-z]+)/,NOTOKEN=/([^!#\$%&'\*\+\-\.\^_`\|~0-9a-z])/g,QUOTED=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"])*)"/,PARAM=new RegExp(TOKEN.source+"(?:=(?:"+TOKEN.source+"|"+QUOTED.source+"))?"),EXT=new RegExp(TOKEN.source+"(?: *; *"+PARAM.source+")*","g"),EXT_LIST=new RegExp("^"+EXT.source+"(?: *, *"+EXT.source+")*$"),NUMBER=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,Parser={parseHeader:function(e){var n=new Offers;if(""===e||void 0===e)return n;if(!EXT_LIST.test(e))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);var t=e.match(EXT);return t.forEach(function(e){var t=e.match(new RegExp(PARAM.source,"g")),r=t.shift(),i={};t.forEach(function(e){var r,n=e.match(PARAM),t=n[1];r=void 0!==n[2]?n[2]:void 0!==n[3]?n[3].replace(/\\/g,""):!0,NUMBER.test(r)&&(r=parseFloat(r)),i.hasOwnProperty(t)?(i[t]=[].concat(i[t]),i[t].push(r)):i[t]=r},this),n.push(r,i)},this),n},serializeParams:function(e,n){var t=[],r=function(e,n){n instanceof Array?n.forEach(function(n){r(e,n)}):n===!0?t.push(e):"number"==typeof n?t.push(e+"="+n):NOTOKEN.test(n)?t.push(e+'="'+n.replace(/"/g,'\\"')+'"'):t.push(e+"="+n)};for(var i in n)r(i,n[i]);return[e].concat(t).join("; ")}},Offers=function(){this._byName={},this._inOrder=[]};Offers.prototype.push=function(e,n){this._byName[e]=this._byName[e]||[],this._byName[e].push(n),this._inOrder.push({name:e,params:n})},Offers.prototype.eachOffer=function(e,n){for(var t=this._inOrder,r=0,i=t.length;i>r;r++)e.call(n,t[r].name,t[r].params)},Offers.prototype.byName=function(e){return this._byName[e]||[]},Offers.prototype.toArray=function(){return this._inOrder.slice()},module.exports=Parser;
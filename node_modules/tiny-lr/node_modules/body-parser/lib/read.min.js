function read(e,n,t,r,a){var i,o;e._body=!0;try{o=contentstream(e,a.inflate),i=o.length,delete o.length}catch(s){return t(s)}a=a||{},a.length=i;var u=null!==a.encoding?a.encoding||"utf-8":null,l=a.verify;a.encoding=l?null:u,getBody(o,a,function(a,i){if(a)return a.status||(a.status=400),o.resume(),void onFinished(e,function(){t(a)});if(l)try{l(e,n,i,u)}catch(a){return a.status||(a.status=403),t(a)}try{i="string"!=typeof i&&null!==u?iconv.decode(i,u):i,e.body=r(i)}catch(a){return a.status||(a.body=i,a.status=400),t(a)}t()})}function contentstream(e,n){var r,i,t=(e.headers["content-encoding"]||"identity").toLowerCase(),a=e.headers["content-length"];if(n===!1&&"identity"!==t)throw r=new Error("content encoding unsupported"),r.status=415,r;switch(t){case"deflate":i=zlib.createInflate(),e.pipe(i);break;case"gzip":i=zlib.createGunzip(),e.pipe(i);break;case"identity":i=e,i.length=a;break;default:throw r=new Error("unsupported content encoding"),r.status=415,r}return i}var getBody=require("raw-body"),iconv=require("iconv-lite"),onFinished=require("on-finished"),typer=require("media-typer"),zlib=require("zlib");module.exports=read;
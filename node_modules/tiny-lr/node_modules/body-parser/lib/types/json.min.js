function json(e){function s(e){if(0===e.length)return{};if(i){var n=firstchar(e);if("{"!==n&&"["!==n)throw new Error("invalid json")}return JSON.parse(e,r)}e=e||{};var n="number"!=typeof e.limit?bytes(e.limit||"100kb"):e.limit,t=e.inflate!==!1,r=e.reviver,i=e.strict!==!1,a=e.type||"json",o=e.verify||!1;if(o!==!1&&"function"!=typeof o)throw new TypeError("option verify must be function");return function(e,r,i){if(e._body)return i();if(e.body=e.body||{},!typeis(e,a))return i();var u=typer.parse(e).parameters.charset||"utf-8";if("utf-"!==u.substr(0,4).toLowerCase()){var l=new Error("unsupported charset");return l.status=415,void i(l)}read(e,r,i,s,{encoding:u,inflate:t,limit:n,verify:o})}}function firstchar(e){var n=firstcharRegExp.exec(e);return n?n[1]:""}var bytes=require("bytes"),read=require("../read"),typer=require("media-typer"),typeis=require("type-is");module.exports=json;var firstcharRegExp=/^\s*(.)/;
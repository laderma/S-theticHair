function onFinished(e,n){return isFinished(e)!==!1?(defer(n),e):(attachListener(e,n),e)}function isFinished(e){var n=e.socket;return"boolean"==typeof e.finished?Boolean(!n||e.finished||!n.writable):"boolean"==typeof e.complete?Boolean(!n||e.complete||!n.readable):void 0}function attachListener(e,n){var t=e.__onFinished,r=e.socket;t&&t.queue||(t=e.__onFinished=createListener(e),first([[r,"error","close"],[e,"end","finish"]],t)),t.queue.push(n)}function createListener(e){function n(t){if(e.__onFinished===n&&(e.__onFinished=null),n.queue){var r=n.queue;n.queue=null;for(var i=0;i<r.length;i++)r[i](t)}}return n.queue=[],n}module.exports=onFinished,module.exports.isFinished=isFinished;var first=require("ee-first"),defer="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};
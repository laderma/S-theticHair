var utils=require("../utils");exports.compile=function(e,n){var t=n.pop(),r="_ctx."+t+' = {};\n  var _output = "";\n',a=utils.map(n,function(e){return{ex:new RegExp("_ctx."+e.name,"g"),re:"_ctx."+t+"."+e.name}});return utils.each(n,function(e){var n=e.compiled;utils.each(a,function(e){n=n.replace(e.ex,e.re)}),r+=n}),r},exports.parse=function(e,n,t,r,a,i,s){var c,d,o=require("../parser").compile,l={resolveFrom:i.filename},u=utils.extend({},i,l);return t.on(r.STRING,function(e){var t=this;if(!c)return c=s.parseFile(e.match.replace(/^("|')|("|')$/g,""),l).tokens,void utils.each(c,function(e){var r,n="";e&&"macro"===e.name&&e.compile&&(r=e.args[0],n+=e.compile(o,e.args,e.content,[],u)+"\n",t.out.push({compiled:n,name:r}))});throw new Error("Unexpected string "+e.match+" on line "+n+".")}),t.on(r.VAR,function(e){var t=this;if(!c||d)throw new Error('Unexpected variable "'+e.match+'" on line '+n+".");if("as"!==e.match)return d=e.match,t.out.push(d),!1}),!0},exports.block=!0;
if("function"!=typeof define)var define=require("amdefine")(module,require);define(function(e,n,t){function o(e){e||(e={}),this._file=i.getArg(e,"file",null),this._sourceRoot=i.getArg(e,"sourceRoot",null),this._sources=new a,this._names=new a,this._mappings=[],this._sourcesContents=null}var r=e("./base64-vlq"),i=e("./util"),a=e("./array-set").ArraySet;o.prototype._version=3,o.fromSourceMap=function(e){var n=e.sourceRoot,t=new o({file:e.file,sourceRoot:n});return e.eachMapping(function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};e.source&&(r.source=e.source,n&&(r.source=i.relative(n,r.source)),r.original={line:e.originalLine,column:e.originalColumn},e.name&&(r.name=e.name)),t.addMapping(r)}),e.sources.forEach(function(n){var r=e.sourceContentFor(n);r&&t.setSourceContent(n,r)}),t},o.prototype.addMapping=function(e){var n=i.getArg(e,"generated"),t=i.getArg(e,"original",null),r=i.getArg(e,"source",null),a=i.getArg(e,"name",null);this._validateMapping(n,t,r,a),r&&!this._sources.has(r)&&this._sources.add(r),a&&!this._names.has(a)&&this._names.add(a),this._mappings.push({generatedLine:n.line,generatedColumn:n.column,originalLine:null!=t&&t.line,originalColumn:null!=t&&t.column,source:r,name:a})},o.prototype.setSourceContent=function(e,n){var t=e;this._sourceRoot&&(t=i.relative(this._sourceRoot,t)),null!==n?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[i.toSetString(t)]=n):(delete this._sourcesContents[i.toSetString(t)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},o.prototype.applySourceMap=function(e,n,t){if(!n){if(!e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');n=e.file}var r=this._sourceRoot;r&&(n=i.relative(r,n));var o=new a,s=new a;this._mappings.forEach(function(a){if(a.source===n&&a.originalLine){var u=e.originalPositionFor({line:a.originalLine,column:a.originalColumn});null!==u.source&&(a.source=u.source,t&&(a.source=i.join(t,a.source)),r&&(a.source=i.relative(r,a.source)),a.originalLine=u.line,a.originalColumn=u.column,null!==u.name&&null!==a.name&&(a.name=u.name))}var l=a.source;l&&!o.has(l)&&o.add(l);var c=a.name;c&&!s.has(c)&&s.add(c)},this),this._sources=o,this._names=s,e.sources.forEach(function(n){var a=e.sourceContentFor(n);a&&(t&&(n=i.join(t,n)),r&&(n=i.relative(r,n)),this.setSourceContent(n,a))},this)},o.prototype._validateMapping=function(e,n,t,r){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||n||t||r)&&!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&t))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:t,original:n,name:r}))},o.prototype._serializeMappings=function(){var l,e=0,n=1,t=0,a=0,o=0,s=0,u="";this._mappings.sort(i.compareByGeneratedPositions);for(var c=0,f=this._mappings.length;f>c;c++){if(l=this._mappings[c],l.generatedLine!==n)for(e=0;l.generatedLine!==n;)u+=";",n++;else if(c>0){if(!i.compareByGeneratedPositions(l,this._mappings[c-1]))continue;u+=","}u+=r.encode(l.generatedColumn-e),e=l.generatedColumn,l.source&&(u+=r.encode(this._sources.indexOf(l.source)-s),s=this._sources.indexOf(l.source),u+=r.encode(l.originalLine-1-a),a=l.originalLine-1,u+=r.encode(l.originalColumn-t),t=l.originalColumn,l.name&&(u+=r.encode(this._names.indexOf(l.name)-o),o=this._names.indexOf(l.name)))}return u},o.prototype._generateSourcesContent=function(e,n){return e.map(function(e){if(!this._sourcesContents)return null;n&&(e=i.relative(n,e));var t=i.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,t)?this._sourcesContents[t]:null},this)},o.prototype.toJSON=function(){var e={version:this._version,file:this._file,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},o.prototype.toString=function(){return JSON.stringify(this)},n.SourceMapGenerator=o});
var expect=require("expect.js"),_=require("lodash"),htmlparser2=require("htmlparser2"),$=require("../"),fixtures=require("./fixtures"),fruits=fixtures.fruits,food=fixtures.food,script='<script src="script.js" type="text/javascript"></script>',multiclass='<p><a class="btn primary" href="#">Save</a></p>';describe("cheerio",function(){it("should get the version",function(){expect(/\d+\.\d+\.\d+/.test($.version)).to.be.ok()}),it("$(null) should return be empty",function(){expect($(null)).to.be.empty()}),it("$(undefined) should be empty",function(){expect($(void 0)).to.be.empty()}),it("$(null) should be empty",function(){expect($("")).to.be.empty()}),it("$(selector) with no context or root should be empty",function(){expect($(".h2")).to.be.empty(),expect($("#fruits")).to.be.empty()}),it("$(node) : should override previously-loaded nodes",function(){var n=$.load("<div><span></span></div>"),e=n("span")[0],t=n(e);expect(t[0]).to.equal(e)}),it("should be able to create html without a root or context",function(){var n=$("<h2>");expect(n).to.not.be.empty(),expect(n).to.have.length(1),expect(n[0].tagName).to.equal("h2")}),it("should be able to create complicated html",function(){var n=$(script);expect(n).to.not.be.empty(),expect(n).to.have.length(1),expect(n[0].attribs.src).to.equal("script.js"),expect(n[0].attribs.type).to.equal("text/javascript"),expect(n[0].childNodes).to.be.empty()});var n=function(n){expect(n).to.have.length(1),n=n[0],expect(n.parentNode.tagName).to.equal("ul"),expect(n.prev).to.be(null),expect(n.next.attribs["class"]).to.equal("orange"),expect(n.childNodes).to.have.length(1),expect(n.childNodes[0].data).to.equal("Apple")};it("should be able to select .apple with only a context",function(){var e=$(".apple",fruits);n(e)}),it("should be able to select .apple with a node as context",function(){var e=$(".apple",$(fruits)[0]);n(e)}),it("should be able to select .apple with only a root",function(){var e=$(".apple",null,fruits);n(e)}),it("should be able to select an id",function(){var n=$("#fruits",null,fruits);expect(n).to.have.length(1),expect(n[0].attribs.id).to.equal("fruits")}),it("should be able to select a tag",function(){var n=$("ul",fruits);expect(n).to.have.length(1),expect(n[0].tagName).to.equal("ul")}),it("should accept a node reference as a context",function(){var n=$("<div><span></span></div>");expect($("span",n[0])).to.have.length(1)}),it("should accept an array of node references as a context",function(){var n=$("<div><span></span></div>");expect($("span",n.toArray())).to.have.length(1)}),it("should select only elements inside given context (Issue #193)",function(){var n=$.load(food),e=n("#fruits"),t=n("li",e);expect(t).to.have.length(3)}),it("should be able to select multiple tags",function(){var n=$("li",null,fruits);expect(n).to.have.length(3);var e=["apple","orange","pear"];n.each(function(n,t){expect(t.attribs["class"]).to.equal(e[n])})}),it('should be able to do: $("#fruits .apple")',function(){var e=$("#fruits .apple",fruits);n(e)}),it('should be able to do: $("li.apple")',function(){var e=$("li.apple",fruits);n(e)}),it("should be able to select by attributes",function(){var e=$("li[class=apple]",fruits);n(e)}),it('should be able to select multiple classes: $(".btn.primary")',function(){var n=$(".btn.primary",multiclass);expect(n).to.have.length(1),expect(n[0].childNodes[0].data).to.equal("Save")}),it("should not create a top-level node",function(){var n=$("* div","<div>");expect(n).to.have.length(0)}),it('should be able to select multiple elements: $(".apple, #fruits")',function(){var e=$(".apple, #fruits",fruits);expect(e).to.have.length(2);var t=_.filter(e,function(n){return"apple"===n.attribs["class"]}),r=_.filter(e,function(n){return"fruits"===n.attribs.id});n(t),expect(r[0].attribs.id).to.equal("fruits")}),it("should select first element $(:first)"),it('should be able to select immediate children: $("#fruits > .pear")',function(){var n=$(food);$(".pear",n).append('<li class="pear">Another Pear!</li>'),expect($("#fruits .pear",n)).to.have.length(2);var e=$("#fruits > .pear",n);expect(e).to.have.length(1),expect(e.attr("class")).to.equal("pear")}),it('should be able to select immediate children: $(".apple + .pear")',function(){var n=$(".apple + li",fruits);expect(n).to.have.length(1),n=$(".apple + .pear",fruits),expect(n).to.have.length(0),n=$(".apple + .orange",fruits),expect(n).to.have.length(1),expect(n.attr("class")).to.equal("orange")}),it('should be able to select immediate children: $(".apple ~ .pear")',function(){var n=$(".apple ~ li",fruits);expect(n).to.have.length(2),n=$(".apple ~ .pear",fruits),expect(n.attr("class")).to.equal("pear")}),it('should handle wildcards on attributes: $("li[class*=r]")',function(){var n=$("li[class*=r]",fruits);expect(n).to.have.length(2),expect(n.eq(0).attr("class")).to.equal("orange"),expect(n.eq(1).attr("class")).to.equal("pear")}),it('should handle beginning of attr selectors: $("li[class^=o]")',function(){var n=$("li[class^=o]",fruits);expect(n).to.have.length(1),expect(n.eq(0).attr("class")).to.equal("orange")}),it('should handle beginning of attr selectors: $("li[class$=e]")',function(){var n=$("li[class$=e]",fruits);expect(n).to.have.length(2),expect(n.eq(0).attr("class")).to.equal("apple"),expect(n.eq(1).attr("class")).to.equal("orange")}),it("should gracefully degrade on complex, unmatched queries",function(){var n=$("Eastern States Cup #8-fin&nbsp;<br>Downhill&nbsp;");expect(n).to.have.length(0)}),it("(extended Array) should not interfere with prototype methods (issue #119)",function(){var n=[];n.find=n.children=n.each=function(){};var e=$(n);expect(e.find).to.be($.prototype.find),expect(e.children).to.be($.prototype.children),expect(e.each).to.be($.prototype.each)}),describe(".load",function(){it("should generate selections as proper instances",function(){var n=$.load(fruits);expect(n(".apple")).to.be.a(n)}),it("should be able to filter down using the context",function(){var n=$.load(fruits),e=n(".apple","ul"),t=n("li","ul");expect(e).to.have.length(1),expect(t).to.have.length(3)}),it("should allow loading a pre-parsed DOM",function(){var n=htmlparser2.parseDOM(food),e=$.load(n);expect(e("ul")).to.have.length(3)}),it("should render xml in html() when options.xmlMode = true",function(){var n='<MixedCaseTag UPPERCASEATTRIBUTE=""></MixedCaseTag>',e='<MixedCaseTag UPPERCASEATTRIBUTE=""/>',t=$.load(n,{xmlMode:!0});expect(t("MixedCaseTag").get(0).tagName).to.equal("MixedCaseTag"),expect(t.html()).to.be(e)}),it("should render xml in html() when options.xmlMode = true passed to html()",function(){var n='<MixedCaseTag UPPERCASEATTRIBUTE=""></MixedCaseTag>',e='<mixedcasetag uppercaseattribute=""/>',t='<mixedcasetag uppercaseattribute=""></mixedcasetag>',r=$.load(n);expect(r("MixedCaseTag").get(0).tagName).to.equal("mixedcasetag"),expect(r.html()).to.be(t),expect(r.html({xmlMode:!0})).to.be(e)}),it("should respect options on the element level",function(){var n="<!doctype html><html><head><title>Some test</title></head><body><footer><p>Copyright &copy; 2003-2014</p></footer></body></html>",e="<p>Copyright &copy; 2003-2014</p>",t="<p>Copyright &#xA9; 2003-2014</p>",r=$.load(n,{decodeEntities:!1}),a=$.load(n);expect(r("footer").html()).to.be(e),expect(a("footer").html()).to.be(t)}),it("should return a fully-qualified Function",function(){var n=$.load("<div>");expect(n).to.be.a(Function)})})});
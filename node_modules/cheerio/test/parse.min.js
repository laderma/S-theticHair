var expect=require("expect.js"),parse=require("../lib/parse"),defaultOpts=require("..").prototype.options,basic="<html></html>",siblings="<h2></h2><p></p>",single="<br/>",singleWrong="<br>",children="<html><br/></html>",li='<li class="durian">Durian</li>',attributes='<img src="hello.png" alt="man waving">',noValueAttribute="<textarea disabled></textarea>",comment="<!-- sexy -->",conditional='<!--[if IE 8]><html class="no-js ie8" lang="en"><![endif]-->',text="lorem ipsum",script='<script type="text/javascript">alert("hi world!");</script>',scriptEmpty="<script></script>",style='<style type="text/css"> h2 { color:blue; } </style>',styleEmpty="<style></style>",directive="<!doctype html>";describe("parse",function(){describe(".eval",function(){it("should parse basic empty tags: "+basic,function(){var n=parse.evaluate(basic,defaultOpts)[0];expect(n.type).to.equal("tag"),expect(n.tagName).to.equal("html"),expect(n.childNodes).to.be.empty()}),it("should handle sibling tags: "+siblings,function(){var n=parse.evaluate(siblings,defaultOpts),e=n[0],t=n[1];expect(n).to.have.length(2),expect(e.tagName).to.equal("h2"),expect(t.tagName).to.equal("p")}),it("should handle single tags: "+single,function(){var n=parse.evaluate(single,defaultOpts)[0];expect(n.type).to.equal("tag"),expect(n.tagName).to.equal("br"),expect(n.childNodes).to.be.empty()}),it("should handle malformatted single tags: "+singleWrong,function(){var n=parse.evaluate(singleWrong,defaultOpts)[0];expect(n.type).to.equal("tag"),expect(n.tagName).to.equal("br"),expect(n.childNodes).to.be.empty()}),it("should handle tags with children: "+children,function(){var n=parse.evaluate(children,defaultOpts)[0];expect(n.type).to.equal("tag"),expect(n.tagName).to.equal("html"),expect(n.childNodes).to.be.ok(),expect(n.childNodes).to.have.length(1)}),it("should handle tags with children: "+li,function(){var n=parse.evaluate(li,defaultOpts)[0];expect(n.childNodes).to.have.length(1),expect(n.childNodes[0].data).to.equal("Durian")}),it("should handle tags with attributes: "+attributes,function(){var n=parse.evaluate(attributes,defaultOpts)[0].attribs;expect(n).to.be.ok(),expect(n.src).to.equal("hello.png"),expect(n.alt).to.equal("man waving")}),it("should handle value-less attributes: "+noValueAttribute,function(){var n=parse.evaluate(noValueAttribute,defaultOpts)[0].attribs;expect(n).to.be.ok(),expect(n.disabled).to.equal("")}),it("should handle comments: "+comment,function(){var n=parse.evaluate(comment,defaultOpts)[0];expect(n.type).to.equal("comment"),expect(n.data).to.equal(" sexy ")}),it("should handle conditional comments: "+conditional,function(){var n=parse.evaluate(conditional,defaultOpts)[0];expect(n.type).to.equal("comment"),expect(n.data).to.equal(conditional.replace("<!--","").replace("-->",""))}),it("should handle text: "+text,function(){var n=parse.evaluate(text,defaultOpts)[0];expect(n.type).to.equal("text"),expect(n.data).to.equal("lorem ipsum")}),it("should handle script tags: "+script,function(){var n=parse.evaluate(script,defaultOpts)[0];expect(n.type).to.equal("script"),expect(n.tagName).to.equal("script"),expect(n.attribs.type).to.equal("text/javascript"),expect(n.childNodes).to.have.length(1),expect(n.childNodes[0].type).to.equal("text"),expect(n.childNodes[0].data).to.equal('alert("hi world!");')}),it("should handle style tags: "+style,function(){var n=parse.evaluate(style,defaultOpts)[0];expect(n.type).to.equal("style"),expect(n.tagName).to.equal("style"),expect(n.attribs.type).to.equal("text/css"),expect(n.childNodes).to.have.length(1),expect(n.childNodes[0].type).to.equal("text"),expect(n.childNodes[0].data).to.equal(" h2 { color:blue; } ")}),it("should handle directives: "+directive,function(){var n=parse.evaluate(directive,defaultOpts)[0];expect(n.type).to.equal("directive"),expect(n.data).to.equal("!doctype html"),expect(n.tagName).to.equal("!doctype")})}),describe(".parse",function(){function n(n){expect(n.tagName).to.equal("root"),expect(n.nextSibling).to.be(null),expect(n.previousSibling).to.be(null),expect(n.parentNode).to.be(null);var e=n.childNodes[0];expect(e.parentNode).to.be(null)}it("should add root to: "+basic,function(){var e=parse(basic,defaultOpts);n(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].tagName).to.equal("html")}),it("should add root to: "+siblings,function(){var e=parse(siblings,defaultOpts);n(e),expect(e.childNodes).to.have.length(2),expect(e.childNodes[0].tagName).to.equal("h2"),expect(e.childNodes[1].tagName).to.equal("p"),expect(e.childNodes[1].parent).to.equal(null)}),it("should add root to: "+comment,function(){var e=parse(comment,defaultOpts);n(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("comment")}),it("should add root to: "+text,function(){var e=parse(text,defaultOpts);n(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("text")}),it("should add root to: "+scriptEmpty,function(){var e=parse(scriptEmpty,defaultOpts);n(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("script")}),it("should add root to: "+styleEmpty,function(){var e=parse(styleEmpty,defaultOpts);n(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("style")}),it("should add root to: "+directive,function(){var e=parse(directive,defaultOpts);n(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("directive")}),it("should expose the DOM level 1 API",function(){var n=parse("<div><a></a><span></span><p></p></div>",defaultOpts).childNodes[0],e=n.childNodes;expect(e).to.have.length(3),expect(n.tagName).to.be("div"),expect(n.firstChild).to.be(e[0]),expect(n.lastChild).to.be(e[2]),expect(e[0].tagName).to.be("a"),expect(e[0].previousSibling).to.be(null),expect(e[0].nextSibling).to.be(e[1]),expect(e[0].parentNode).to.be(n),expect(e[0].childNodes).to.have.length(0),expect(e[0].firstChild).to.be(null),expect(e[0].lastChild).to.be(null),expect(e[1].tagName).to.be("span"),expect(e[1].previousSibling).to.be(e[0]),expect(e[1].nextSibling).to.be(e[2]),expect(e[1].parentNode).to.be(n),expect(e[1].childNodes).to.have.length(0),expect(e[1].firstChild).to.be(null),expect(e[1].lastChild).to.be(null),expect(e[2].tagName).to.be("p"),expect(e[2].previousSibling).to.be(e[1]),expect(e[2].nextSibling).to.be(null),expect(e[2].parentNode).to.be(n),expect(e[2].childNodes).to.have.length(0),expect(e[2].firstChild).to.be(null),expect(e[2].lastChild).to.be(null)})})});
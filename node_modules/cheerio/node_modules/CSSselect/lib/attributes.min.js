var DomUtils=require("domutils"),hasAttrib=DomUtils.hasAttrib,getAttributeValue=DomUtils.getAttributeValue,falseFunc=require("./basefunctions.js").falseFunc,reChars=/[-[\]{}()*+?.,\\^$|#\s]/g,attributeRules={__proto__:null,equals:function(e,n){var t=n.name,r=n.value;return n.ignoreCase?(r=r.toLowerCase(),function(n){var a=getAttributeValue(n,t);return null!=a&&a.toLowerCase()===r&&e(n)}):function(n){return getAttributeValue(n,t)===r&&e(n)}},hyphen:function(e,n){var t=n.name,r=n.value,a=r.length;return n.ignoreCase?(r=r.toLowerCase(),function(n){var i=getAttributeValue(n,t);return null!=i&&(i.length===a||"-"===i.charAt(a))&&i.substr(0,a).toLowerCase()===r&&e(n)}):function(n){var i=getAttributeValue(n,t);return null!=i&&i.substr(0,a)===r&&(i.length===a||"-"===i.charAt(a))&&e(n)}},element:function(e,n){var t=n.name,r=n.value;if(/\s/.test(r))return falseFunc;r=r.replace(reChars,"\\$&");var a="(?:^|\\s)"+r+"(?:$|\\s)",i=n.ignoreCase?"i":"",s=new RegExp(a,i);return function(n){var r=getAttributeValue(n,t);return null!=r&&s.test(r)&&e(n)}},exists:function(e,n){var t=n.name;return function(n){return hasAttrib(n,t)&&e(n)}},start:function(e,n){var t=n.name,r=n.value,a=r.length;return 0===a?falseFunc:n.ignoreCase?(r=r.toLowerCase(),function(n){var i=getAttributeValue(n,t);return null!=i&&i.substr(0,a).toLowerCase()===r&&e(n)}):function(n){var i=getAttributeValue(n,t);return null!=i&&i.substr(0,a)===r&&e(n)}},end:function(e,n){var t=n.name,r=n.value,a=-r.length;return 0===a?falseFunc:n.ignoreCase?(r=r.toLowerCase(),function(n){var i=getAttributeValue(n,t);return null!=i&&i.substr(a).toLowerCase()===r&&e(n)}):function(n){var i=getAttributeValue(n,t);return null!=i&&i.substr(a)===r&&e(n)}},any:function(e,n){var t=n.name,r=n.value;if(""===r)return falseFunc;if(n.ignoreCase){var a=new RegExp(r.replace(reChars,"\\$&"),"i");return function(n){var r=getAttributeValue(n,t);return null!=r&&a.test(r)&&e(n)}}return function(n){var a=getAttributeValue(n,t);return null!=a&&a.indexOf(r)>=0&&e(n)}},not:function(e,n){var t=n.name,r=n.value;return""===r?function(n){return!!getAttributeValue(n,t)&&e(n)}:n.ignoreCase?(r=r.toLowerCase(),function(n){var a=getAttributeValue(n,t);return null!=a&&a.toLowerCase()!==r&&e(n)}):function(n){return getAttributeValue(n,t)!==r&&e(n)}}};module.exports={compile:function(e,n){return attributeRules[n.action](e,n)},rules:attributeRules};
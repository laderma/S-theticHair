function eventReducer(e,n){return"onerror"===n[0]||"onend"===n[0]||("ontext"===n[0]&&e.length&&"text"===e[e.length-1].event?e[e.length-1].data[0]+=n[1]:e.push({event:n[0].substr(2),data:n.slice(1)})),e}function getCallback(e,n){var t=!1;return function(r,a){assert.ifError(r);try{assert.deepEqual(e,a,"didn't get expected output")}catch(i){throw i.expected=JSON.stringify(e,null,2),i.actual=JSON.stringify(a,null,2),i}t?n():t=!0}}var htmlparser2=require(".."),fs=require("fs"),path=require("path"),assert=require("assert"),Parser=htmlparser2.Parser,CollectingHandler=htmlparser2.CollectingHandler;exports.writeToParser=function(e,n,t){for(var r=new Parser(e,n),a=0;a<t.length;a++)r.write(t.charAt(a));r.end(),r.parseComplete(t)},exports.getEventCollector=function(e){function t(){e(null,n.events.reduce(eventReducer,[]))}var n=new CollectingHandler({onerror:e,onend:t});return n},exports.mochaTest=function(e,n,t){function r(){var t=path.join(n,e);fs.readdirSync(t).filter(RegExp.prototype.test,/^[^\._]/).map(function(e){return path.join(t,e)}).map(require).forEach(a)}function a(e){it(e.name,function(n){t(e,getCallback(e.expected,n))})}describe(e,r)};
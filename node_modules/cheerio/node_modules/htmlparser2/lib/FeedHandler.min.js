function FeedHandler(e,n){this.init(e,n)}function getElements(e,n){return DomUtils.getElementsByTagName(e,n,!0)}function getOneElement(e,n){return DomUtils.getElementsByTagName(e,n,!0,1)[0]}function fetch(e,n,t){return DomUtils.getText(DomUtils.getElementsByTagName(e,n,t,1)).trim()}function addConditionally(e,n,t,r,a){var i=fetch(t,r,a);i&&(e[n]=i)}var index=require("./index.js"),DomHandler=index.DomHandler,DomUtils=index.DomUtils;require("util").inherits(FeedHandler,DomHandler),FeedHandler.prototype.init=DomHandler;var isValidFeed=function(e){return"rss"===e||"feed"===e||"rdf:RDF"===e};FeedHandler.prototype.onend=function(){var t,r,e={},n=getOneElement(isValidFeed,this.dom);n&&("feed"===n.name?(r=n.children,e.type="atom",addConditionally(e,"id","id",r),addConditionally(e,"title","title",r),(t=getOneElement("link",r))&&(t=t.attribs)&&(t=t.href)&&(e.link=t),addConditionally(e,"description","subtitle",r),(t=fetch("updated",r))&&(e.updated=new Date(t)),addConditionally(e,"author","email",r,!0),e.items=getElements("entry",r).map(function(e){var t,n={};return e=e.children,addConditionally(n,"id","id",e),addConditionally(n,"title","title",e),(t=getOneElement("link",e))&&(t=t.attribs)&&(t=t.href)&&(n.link=t),(t=fetch("summary",e)||fetch("content",e))&&(n.description=t),(t=fetch("updated",e))&&(n.pubDate=new Date(t)),n})):(r=getOneElement("channel",n.children).children,e.type=n.name.substr(0,3),e.id="",addConditionally(e,"title","title",r),addConditionally(e,"link","link",r),addConditionally(e,"description","description",r),(t=fetch("lastBuildDate",r))&&(e.updated=new Date(t)),addConditionally(e,"author","managingEditor",r,!0),e.items=getElements("item",n.children).map(function(e){var t,n={};return e=e.children,addConditionally(n,"id","guid",e),addConditionally(n,"title","title",e),addConditionally(n,"link","link",e),addConditionally(n,"description","description",e),(t=fetch("pubDate",e))&&(n.pubDate=new Date(t)),n}))),this.dom=e,DomHandler.prototype._handleCallback.call(this,n?null:Error("couldn't find root of feed"))},module.exports=FeedHandler;
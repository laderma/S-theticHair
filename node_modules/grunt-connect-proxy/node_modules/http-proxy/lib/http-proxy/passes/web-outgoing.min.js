var url=require("url"),passes=exports,redirectRegex=/^30(1|2|7|8)$/;[function(e,n,t){"1.0"===e.httpVersion&&delete t.headers["transfer-encoding"]},function(e,n,t){"1.0"===e.httpVersion?t.headers.connection=e.headers.connection||"close":t.headers.connection||(t.headers.connection=e.headers.connection||"keep-alive")},function(e,n,t,r){if((r.hostRewrite||r.autoRewrite||r.protocolRewrite)&&t.headers.location&&redirectRegex.test(t.statusCode)){var i=url.parse(r.target),a=url.parse(t.headers.location);if(i.host!=a.host)return;r.hostRewrite?a.host=r.hostRewrite:r.autoRewrite&&(a.host=e.headers.host),r.protocolRewrite&&(a.protocol=r.protocolRewrite),t.headers.location=a.format()}},function(e,n,t){Object.keys(t.headers).forEach(function(e){n.setHeader(e,t.headers[e])})},function(e,n,t){n.writeHead(t.statusCode)}].forEach(function(e){passes[e.name]=e});
var http=require("http"),https=require("https"),web_o=require("./web-outgoing"),common=require("../common"),passes=exports;web_o=Object.keys(web_o).map(function(e){return web_o[e]}),[function(e,n,t){"DELETE"!==e.method&&"OPTIONS"!==e.method||e.headers["content-length"]||(e.headers["content-length"]="0")},function(e,n,t){t.timeout&&e.socket.setTimeout(t.timeout)},function(e,n,t){if(t.xfwd){var r=e.isSpdy||common.hasEncryptedConnection(e),i={"for":e.connection.remoteAddress||e.socket.remoteAddress,port:common.getPort(e),proto:r?"https":"http"};["for","port","proto"].forEach(function(n){e.headers["x-forwarded-"+n]=(e.headers["x-forwarded-"+n]||"")+(e.headers["x-forwarded-"+n]?",":"")+i[n]})}},function(e,n,t,r,i,a){function l(r){a?a(r,e,n,t.target):i.emit("error",r,e,n,t.target)}if(i.emit("start",e,n,t.target),t.forward){var o=("https:"===t.forward.protocol?https:http).request(common.setupOutgoing(t.ssl||{},t,e,"forward"));if((t.buffer||e).pipe(o),!t.target)return n.end()}var s=("https:"===t.target.protocol?https:http).request(common.setupOutgoing(t.ssl||{},t,e));s.on("socket",function(r){i&&i.emit("proxyReq",s,e,n,t)}),t.proxyTimeout&&s.setTimeout(t.proxyTimeout,function(){s.abort()}),e.on("aborted",function(){s.abort()}),e.on("error",l),s.on("error",l),(t.buffer||e).pipe(s),s.on("response",function(r){i&&i.emit("proxyRes",r,e,n);for(var a=0;a<web_o.length&&!web_o[a](e,n,r,t);a++);r.on("end",function(){i.emit("end",e,n,r)}),r.pipe(n)})}].forEach(function(e){passes[e.name]=e});
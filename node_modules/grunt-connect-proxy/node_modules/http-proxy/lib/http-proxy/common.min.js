function hasPort(e){return!!~e.indexOf(":")}var common=exports,url=require("url"),extend=require("util")._extend,required=require("requires-port"),upgradeHeader=/(^|,)\s*upgrade\s*($|,)/i,isSSL=/^https|wss/;common.isSSL=isSSL,common.setupOutgoing=function(e,n,t,r){e.port=n[r||"target"].port||(isSSL.test(n[r||"target"].protocol)?443:80),["host","hostname","socketPath","pfx","key","passphrase","cert","ca","ciphers","secureProtocol"].forEach(function(t){e[t]=n[r||"target"][t]}),e.method=t.method,e.headers=extend({},t.headers),n.headers&&extend(e.headers,n.headers),n.auth&&(e.auth=n.auth),isSSL.test(n[r||"target"].protocol)&&(e.rejectUnauthorized="undefined"==typeof n.secure?!0:n.secure),e.agent=n.agent||!1,e.localAddress=n.localAddress,e.agent||(e.headers=e.headers||{},"string"==typeof e.headers.connection&&upgradeHeader.test(e.headers.connection)||(e.headers.connection="close"));var a=n[r||"target"],i=a&&n.prependPath!==!1?a.path||"":"",o=n.toProxy?t.url:url.parse(t.url).path||"/";return o=n.ignorePath?"/":o,e.path=common.urlJoin(i,o),n.changeOrigin&&(e.headers.host=required(e.port,n[r||"target"].protocol)&&!hasPort(e.host)?e.host+":"+e.port:e.host),e},common.setupSocket=function(e){return e.setTimeout(0),e.setNoDelay(!0),e.setKeepAlive(!0,0),e},common.getPort=function(e){var n=e.headers.host?e.headers.host.match(/:(\d+)/):"";return n?n[1]:common.hasEncryptedConnection(e)?"443":"80"},common.hasEncryptedConnection=function(e){return Boolean(e.connection.encrypted||e.connection.pair)},common.urlJoin=function(){var a,e=Array.prototype.slice.call(arguments),n=e.length-1,t=e[n],r=t.split("?");return e[n]=r.shift(),a=[e.filter(Boolean).join("/").replace(/\/+/g,"/").replace(/:\//g,"://")],a.push.apply(a,r),a.join("?")};
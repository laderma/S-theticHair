"use strict";var fs=require("fs"),path=require("path"),crypto=require("crypto");module.exports=function(n){function e(e,t,r){var a=crypto.createHash(t);return n.log.verbose.write("Hashing "+e+"..."),a.update(n.file.read(e)),a.digest(r)}n.registerMultiTask("rev","Prefix static asset file names with a content hash",function(){var t=this.options({algorithm:"md5",length:8});this.files.forEach(function(r){r.src.forEach(function(r){var a=e(r,t.algorithm,"hex"),i=a.slice(0,t.length),s=[i,path.basename(r)].join("."),o=path.resolve(path.dirname(r),s);n.verbose.ok().ok(a),fs.renameSync(r,o),n.log.write(r+" ").ok(s)})})})};
"use strict";function stdoutEqual(e,n,t){var r="";hooker.hook(process.stdout,"write",{pre:function(e){return r+=e,hooker.preempt()}}),n(),stdoutUnmute(),e.equal(r,t)}function stdoutMute(){hooker.hook(process.stdout,"write",{pre:function(){return hooker.preempt()}})}function stdoutUnmute(){hooker.unhook(process.stdout,"write")}function repeat(e,n,t){for(var r=e,a=1;n>a;a++)r+=(t||"")+e;return r}var legacyLog=require("../"),Log=legacyLog.Log,hooker=require("hooker"),fooBuffer=new Buffer("foo");exports["Log instance"]={setUp:function(e){this.grunt={fail:{errorcount:0}},e()},write:function(e){e.expect(4);var n=new Log;stdoutEqual(e,function(){n.write("")},""),stdoutEqual(e,function(){n.write("foo")},"foo"),stdoutEqual(e,function(){n.write("%s","foo")},"foo"),stdoutEqual(e,function(){n.write(fooBuffer)},"foo"),e.done()},writeln:function(e){e.expect(4);var n=new Log;stdoutEqual(e,function(){n.writeln()},"\n"),stdoutEqual(e,function(){n.writeln("foo")},"foo\n"),stdoutEqual(e,function(){n.writeln("%s","foo")},"foo\n"),stdoutEqual(e,function(){n.writeln(fooBuffer)},"foo\n"),e.done()},warn:function(e){e.expect(5);var n=new Log({grunt:this.grunt});stdoutEqual(e,function(){n.warn()},"ERROR".red+"\n"),stdoutEqual(e,function(){n.warn("foo")},">> ".red+"foo\n"),stdoutEqual(e,function(){n.warn("%s","foo")},">> ".red+"foo\n"),stdoutEqual(e,function(){n.warn(fooBuffer)},">> ".red+"foo\n"),e.equal(this.grunt.fail.errorcount,0),e.done()},error:function(e){e.expect(5);var n=new Log({grunt:this.grunt});stdoutEqual(e,function(){n.error()},"ERROR".red+"\n"),stdoutEqual(e,function(){n.error("foo")},">> ".red+"foo\n"),stdoutEqual(e,function(){n.error("%s","foo")},">> ".red+"foo\n"),stdoutEqual(e,function(){n.error(fooBuffer)},">> ".red+"foo\n"),e.equal(this.grunt.fail.errorcount,4),e.done()},ok:function(e){e.expect(4);var n=new Log({grunt:this.grunt});stdoutEqual(e,function(){n.ok()},"OK".green+"\n"),stdoutEqual(e,function(){n.ok("foo")},">> ".green+"foo\n"),stdoutEqual(e,function(){n.ok("%s","foo")},">> ".green+"foo\n"),stdoutEqual(e,function(){n.ok(fooBuffer)},">> ".green+"foo\n"),e.done()},errorlns:function(e){e.expect(2);var n=new Log({grunt:this.grunt});stdoutEqual(e,function(){n.errorlns(repeat("foo",30," "))},">> ".red+repeat("foo",19," ")+"\n>> ".red+repeat("foo",11," ")+"\n"),e.equal(this.grunt.fail.errorcount,1),e.done()},oklns:function(e){e.expect(1);var n=new Log;stdoutEqual(e,function(){n.oklns(repeat("foo",30," "))},">> ".green+repeat("foo",19," ")+"\n>> ".green+repeat("foo",11," ")+"\n"),e.done()},success:function(e){e.expect(4);var n=new Log;stdoutEqual(e,function(){n.success()},"".green+"\n"),stdoutEqual(e,function(){n.success("foo")},"foo".green+"\n"),stdoutEqual(e,function(){n.success("%s","foo")},"foo".green+"\n"),stdoutEqual(e,function(){n.success(fooBuffer)},"foo".green+"\n"),e.done()},fail:function(e){e.expect(4);var n=new Log;stdoutEqual(e,function(){n.fail()},"".red+"\n"),stdoutEqual(e,function(){n.fail("foo")},"foo".red+"\n"),stdoutEqual(e,function(){n.fail("%s","foo")},"foo".red+"\n"),stdoutEqual(e,function(){n.fail(fooBuffer)},"foo".red+"\n"),e.done()},header:function(e){e.expect(5);var n=new Log;stdoutEqual(e,function(){n.header()},"".underline+"\n"),stdoutEqual(e,function(){n.header()},"\n"+"".underline+"\n"),stdoutEqual(e,function(){n.header("foo")},"\n"+"foo".underline+"\n"),stdoutEqual(e,function(){n.header("%s","foo")},"\n"+"foo".underline+"\n"),stdoutEqual(e,function(){n.header(fooBuffer)},"\n"+"foo".underline+"\n"),e.done()},subhead:function(e){e.expect(5);var n=new Log;stdoutEqual(e,function(){n.subhead()},"".bold+"\n"),stdoutEqual(e,function(){n.subhead()},"\n"+"".bold+"\n"),stdoutEqual(e,function(){n.subhead("foo")},"\n"+"foo".bold+"\n"),stdoutEqual(e,function(){n.subhead("%s","foo")},"\n"+"foo".bold+"\n"),stdoutEqual(e,function(){n.subhead(fooBuffer)},"\n"+"foo".bold+"\n"),e.done()},writetableln:function(e){e.expect(1);var n=new Log;stdoutEqual(e,function(){n.writetableln([10],[repeat("foo",10)])},"foofoofoof\noofoofoofo\nofoofoofoo\n"),e.done()},writelns:function(e){e.expect(1);var n=new Log;stdoutEqual(e,function(){n.writelns(repeat("foo",30," "))},repeat("foo",20," ")+"\n"+repeat("foo",10," ")+"\n"),e.done()},writeflags:function(e){e.expect(3);var n=new Log;stdoutEqual(e,function(){n.writeflags(["a","b"])},"Flags: "+"a".cyan+", "+"b".cyan+"\n"),stdoutEqual(e,function(){n.writeflags(["a","b"],"Prefix")},"Prefix: "+"a".cyan+", "+"b".cyan+"\n"),stdoutEqual(e,function(){n.writeflags({a:!0,b:!1,c:0,d:null},"Prefix")},"Prefix: "+"a".cyan+", "+"b=false".cyan+", "+"c=0".cyan+", "+"d=null".cyan+"\n"),e.done()},always:function(e){e.expect(3);var n=new Log;e.strictEqual(n.always,n),e.strictEqual(n.verbose.always,n),e.strictEqual(n.notverbose.always,n),e.done()},or:function(e){e.expect(2);var n=new Log;e.strictEqual(n.verbose.or,n.notverbose),e.strictEqual(n.notverbose.or,n.verbose),e.done()},hasLogged:function(e){e.expect(24);var n=new Log;e.equal(n.hasLogged,!1),e.equal(n.verbose.hasLogged,!1),e.equal(n.notverbose.hasLogged,!1),n.write(""),e.equal(n.hasLogged,!0),e.equal(n.verbose.hasLogged,!0),e.equal(n.notverbose.hasLogged,!0),n=new Log({verbose:!0}),n.verbose.write(""),e.equal(n.hasLogged,!0),e.equal(n.verbose.hasLogged,!0),e.equal(n.notverbose.hasLogged,!0),n=new Log,n.notverbose.write(""),e.equal(n.hasLogged,!0),e.equal(n.verbose.hasLogged,!0),e.equal(n.notverbose.hasLogged,!0),stdoutMute(),n=new Log({debug:!0}),n.debug(""),e.equal(n.hasLogged,!0),e.equal(n.verbose.hasLogged,!0),e.equal(n.notverbose.hasLogged,!0),stdoutUnmute(),n=new Log,n.verbose.write(""),e.equal(n.hasLogged,!1),e.equal(n.verbose.hasLogged,!1),e.equal(n.notverbose.hasLogged,!1),n=new Log({verbose:!0}),n.notverbose.write(""),e.equal(n.hasLogged,!1),e.equal(n.verbose.hasLogged,!1),e.equal(n.notverbose.hasLogged,!1),n=new Log,n.debug(""),e.equal(n.hasLogged,!1),e.equal(n.verbose.hasLogged,!1),e.equal(n.notverbose.hasLogged,!1),e.done()},muted:function(e){e.expect(30);var n=new Log;e.equal(n.muted,!1),e.equal(n.verbose.muted,!1),e.equal(n.notverbose.muted,!1),e.equal(n.options.muted,!1),e.equal(n.verbose.options.muted,!1),e.equal(n.notverbose.options.muted,!1),n.muted=!0,e.equal(n.muted,!0),e.equal(n.verbose.muted,!0),e.equal(n.notverbose.muted,!0),e.equal(n.options.muted,!0),e.equal(n.verbose.options.muted,!0),e.equal(n.notverbose.options.muted,!0),n.muted=!1,e.equal(n.muted,!1),e.equal(n.verbose.muted,!1),e.equal(n.notverbose.muted,!1),e.equal(n.options.muted,!1),e.equal(n.verbose.options.muted,!1),e.equal(n.notverbose.options.muted,!1),n.options.muted=!0,e.equal(n.muted,!0),e.equal(n.verbose.muted,!0),e.equal(n.notverbose.muted,!0),e.equal(n.options.muted,!0),e.equal(n.verbose.options.muted,!0),e.equal(n.notverbose.options.muted,!0),n.options.muted=!1,e.equal(n.muted,!1),e.equal(n.verbose.muted,!1),e.equal(n.notverbose.muted,!1),e.equal(n.options.muted,!1),e.equal(n.verbose.options.muted,!1),e.equal(n.notverbose.options.muted,!1),e.done()},verbose:function(e){e.expect(15);var n=new Log;n.muted=!0,e.strictEqual(n.verbose.write(""),n.verbose),e.strictEqual(n.verbose.writeln(""),n.verbose),e.strictEqual(n.verbose.warn(""),n.verbose),e.strictEqual(n.verbose.error(""),n.verbose),e.strictEqual(n.verbose.ok(""),n.verbose),e.strictEqual(n.verbose.errorlns(""),n.verbose),e.strictEqual(n.verbose.oklns(""),n.verbose),e.strictEqual(n.verbose.success(""),n.verbose),e.strictEqual(n.verbose.fail(""),n.verbose),e.strictEqual(n.verbose.header(""),n.verbose),e.strictEqual(n.verbose.subhead(""),n.verbose),e.strictEqual(n.verbose.debug(""),n.verbose),e.strictEqual(n.verbose.writetableln([]),n.verbose),e.strictEqual(n.verbose.writelns(""),n.verbose),e.strictEqual(n.verbose.writeflags([]),n.verbose),e.done()},notverbose:function(e){e.expect(15);var n=new Log;n.muted=!0,e.strictEqual(n.notverbose.write(""),n.notverbose),e.strictEqual(n.notverbose.writeln(""),n.notverbose),e.strictEqual(n.notverbose.warn(""),n.notverbose),e.strictEqual(n.notverbose.error(""),n.notverbose),e.strictEqual(n.notverbose.ok(""),n.notverbose),e.strictEqual(n.notverbose.errorlns(""),n.notverbose),e.strictEqual(n.notverbose.oklns(""),n.notverbose),e.strictEqual(n.notverbose.success(""),n.notverbose),e.strictEqual(n.notverbose.fail(""),n.notverbose),e.strictEqual(n.notverbose.header(""),n.notverbose),e.strictEqual(n.notverbose.subhead(""),n.notverbose),e.strictEqual(n.notverbose.debug(""),n.notverbose),e.strictEqual(n.notverbose.writetableln([]),n.notverbose),e.strictEqual(n.notverbose.writelns(""),n.notverbose),e.strictEqual(n.notverbose.writeflags([]),n.notverbose),e.done()},"options.debug = true":function(e){e.expect(4);var n=new Log({debug:!0});stdoutEqual(e,function(){n.debug()},"[D] "+"".magenta+"\n"),stdoutEqual(e,function(){n.debug("foo")},"[D] "+"foo".magenta+"\n"),stdoutEqual(e,function(){n.debug("%s","foo")},"[D] "+"foo".magenta+"\n"),stdoutEqual(e,function(){n.debug(fooBuffer)},"[D] "+"foo".magenta+"\n"),e.done()},"options.verbose = false":function(e){e.expect(7);var n=new Log({verbose:!1});stdoutEqual(e,function(){n.notverbose.write("foo")},"foo"),stdoutEqual(e,function(){n.notverbose.write("%s","foo")},"foo"),stdoutEqual(e,function(){n.notverbose.write(fooBuffer)},"foo"),stdoutEqual(e,function(){n.verbose.write("foo")},""),stdoutEqual(e,function(){n.verbose.write("%s","foo")},""),stdoutEqual(e,function(){n.verbose.write(fooBuffer)},""),stdoutEqual(e,function(){n.verbose.write("a").or.write("b")},"b"),e.done()},"options.verbose = true":function(e){e.expect(7);var n=new Log({verbose:!0});stdoutEqual(e,function(){n.verbose.write("foo")},"foo"),stdoutEqual(e,function(){n.verbose.write("%s","foo")},"foo"),stdoutEqual(e,function(){n.verbose.write(fooBuffer)},"foo"),stdoutEqual(e,function(){n.notverbose.write("foo")},""),stdoutEqual(e,function(){n.notverbose.write("%s","foo")},""),stdoutEqual(e,function(){n.notverbose.write(fooBuffer)},""),stdoutEqual(e,function(){n.notverbose.write("a").or.write("b")},"b"),e.done()},"options.debug = false":function(e){e.expect(1);var n=new Log({debug:!1});stdoutEqual(e,function(){n.debug("foo")},""),e.done()},"options.color = true":function(e){e.expect(1);var n=new Log({color:!0});stdoutEqual(e,function(){n.write("foo".blue+"bar".underline)},"foo".blue+"bar".underline),e.done()},"options.color = false":function(e){e.expect(1);var n=new Log({color:!1});stdoutEqual(e,function(){n.write("foo".blue+"bar".underline)},"foobar"),e.done()},"perma-bind this when passing grunt in (backcompat)":function(e){e.expect(43);var n=new Log({grunt:this.grunt});stdoutMute(),["write","writeln","warn","error","ok","errorlns","oklns","success","fail","header","subhead","debug"].forEach(function(t){var r=n[t],a=n.verbose[t],i=n.notverbose[t];e.equal(r(),n,"Should return log if invoked in a way where this is not log."),e.equal(a(),n.verbose,"Should return log.verbose if invoked in a way where this is not log."),e.equal(i(),n.notverbose,"Should return log.notverbose if invoked in a way where this is not log.")}),e.doesNotThrow(function(){var e=n.writetableln;e([])},"Should not throw if invoked in a way where this is not log."),e.doesNotThrow(function(){var e=n.writelns;e([])},"Should not throw if invoked in a way where this is not log."),e.doesNotThrow(function(){var e=n.writeflags;e([])},"Should not throw if invoked in a way where this is not log."),e.doesNotThrow(function(){var e=n.wordlist;e([])},"Should not throw if invoked in a way where this is not log."),e.doesNotThrow(function(){var e=n.uncolor;e("")},"Should not throw if invoked in a way where this is not log."),e.doesNotThrow(function(){var e=n.wraptext;e(1,"")},"Should not throw if invoked in a way where this is not log."),e.doesNotThrow(function(){var e=n.table;e([],"")},"Should not throw if invoked in a way where this is not log."),stdoutUnmute(),e.done()}},exports.Helpers={uncolor:function(e){e.expect(2);var n=new Log;e.ok(n.uncolor),e.strictEqual(n.uncolor,legacyLog.uncolor),e.done()},wordlist:function(e){e.expect(2);var n=new Log;e.ok(n.wordlist),e.strictEqual(n.wordlist,legacyLog.wordlist),e.done()},wraptext:function(e){e.expect(2);var n=new Log;e.ok(n.wraptext),e.strictEqual(n.wraptext,legacyLog.wraptext),e.done()},table:function(e){e.expect(2);var n=new Log;e.ok(n.table),e.strictEqual(n.table,legacyLog.table),e.done()}};
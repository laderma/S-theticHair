!function(){function e(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function n(){return 1}function t(e){return this instanceof t?("number"==typeof e&&(e={max:e}),e||(e={}),this._max=e.max,(!this._max||"number"!=typeof this._max||this._max<=0)&&(this._max=1/0),this._lengthCalculator=e.length||n,"function"!=typeof this._lengthCalculator&&(this._lengthCalculator=n),this._allowStale=e.stale||!1,this._maxAge=e.maxAge||null,this._dispose=e.dispose,void this.reset()):new t(e)}function r(e,n,t){var r=e._cache[n];return r&&(i(e,r)?(l(e,r),e._allowStale||(r=void 0)):t&&a(e,r),r&&(r=r.value)),r}function i(e,n){if(!n||!n.maxAge&&!e._maxAge)return!1;var t=!1,r=Date.now()-n.now;return t=n.maxAge?r>n.maxAge:e._maxAge&&r>e._maxAge}function a(e,n){s(e,n),n.lu=e._mru++,e._lruList[n.lu]=n}function o(e){for(;e._lru<e._mru&&e._length>e._max;)l(e,e._lruList[e._lru])}function s(e,n){for(delete e._lruList[n.lu];e._lru<e._mru&&!e._lruList[e._lru];)e._lru++}function l(e,n){n&&(e._dispose&&e._dispose(n.key,n.value),e._length-=n.length,e._itemCount--,delete e._cache[n.key],s(e,n))}function u(e,n,t,r,i,a){this.key=e,this.value=n,this.lu=t,this.length=r,this.now=i,a&&(this.maxAge=a)}"object"==typeof module&&module.exports?module.exports=t:this.LRUCache=t,Object.defineProperty(t.prototype,"max",{set:function(e){(!e||"number"!=typeof e||0>=e)&&(e=1/0),this._max=e,this._length>this._max&&o(this)},get:function(){return this._max},enumerable:!0}),Object.defineProperty(t.prototype,"lengthCalculator",{set:function(e){if("function"!=typeof e){this._lengthCalculator=n,this._length=this._itemCount;for(var t in this._cache)this._cache[t].length=1}else{this._lengthCalculator=e,this._length=0;for(var t in this._cache)this._cache[t].length=this._lengthCalculator(this._cache[t].value),this._length+=this._cache[t].length}this._length>this._max&&o(this)},get:function(){return this._lengthCalculator},enumerable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0}),Object.defineProperty(t.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:!0}),t.prototype.forEach=function(e,n){n=n||this;for(var t=0,r=this._itemCount,a=this._mru-1;a>=0&&r>t;a--)if(this._lruList[a]){t++;var o=this._lruList[a];i(this,o)&&(l(this,o),this._allowStale||(o=void 0)),o&&e.call(n,o.value,o.key,this)}},t.prototype.keys=function(){for(var e=new Array(this._itemCount),n=0,t=this._mru-1;t>=0&&n<this._itemCount;t--)if(this._lruList[t]){var r=this._lruList[t];e[n++]=r.key}return e},t.prototype.values=function(){for(var e=new Array(this._itemCount),n=0,t=this._mru-1;t>=0&&n<this._itemCount;t--)if(this._lruList[t]){var r=this._lruList[t];e[n++]=r.value}return e},t.prototype.reset=function(){if(this._dispose&&this._cache)for(var e in this._cache)this._dispose(e,this._cache[e].value);this._cache=Object.create(null),this._lruList=Object.create(null),this._mru=0,this._lru=0,this._length=0,this._itemCount=0},t.prototype.dump=function(){return this._cache},t.prototype.dumpLru=function(){return this._lruList},t.prototype.set=function(n,t,r){r=r||this._maxAge;var i=r?Date.now():0;if(e(this._cache,n))return this._dispose&&this._dispose(n,this._cache[n].value),this._cache[n].now=i,this._cache[n].maxAge=r,this._cache[n].value=t,this.get(n),!0;var a=this._lengthCalculator(t),s=new u(n,t,this._mru++,a,i,r);return s.length>this._max?(this._dispose&&this._dispose(n,t),!1):(this._length+=s.length,this._lruList[s.lu]=this._cache[n]=s,this._itemCount++,this._length>this._max&&o(this),!0)},t.prototype.has=function(n){if(!e(this._cache,n))return!1;var t=this._cache[n];return i(this,t)?!1:!0},t.prototype.get=function(e){return r(this,e,!0)},t.prototype.peek=function(e){return r(this,e,!1)},t.prototype.pop=function(){var e=this._lruList[this._lru];return l(this,e),e||null},t.prototype.del=function(e){l(this,this._cache[e])}}();
var test=require("tap").test,LRU=require("../");test("basic",function(e){var n=new LRU({max:10});n.set("key","value"),e.equal(n.get("key"),"value"),e.equal(n.get("nada"),void 0),e.equal(n.length,1),e.equal(n.max,10),e.end()}),test("least recently set",function(e){var n=new LRU(2);n.set("a","A"),n.set("b","B"),n.set("c","C"),e.equal(n.get("c"),"C"),e.equal(n.get("b"),"B"),e.equal(n.get("a"),void 0),e.end()}),test("lru recently gotten",function(e){var n=new LRU(2);n.set("a","A"),n.set("b","B"),n.get("a"),n.set("c","C"),e.equal(n.get("c"),"C"),e.equal(n.get("b"),void 0),e.equal(n.get("a"),"A"),e.end()}),test("del",function(e){var n=new LRU(2);n.set("a","A"),n.del("a"),e.equal(n.get("a"),void 0),e.end()}),test("max",function(e){var n=new LRU(3);n.max=100;for(var t=0;100>t;t++)n.set(t,t);e.equal(n.length,100);for(var t=0;100>t;t++)e.equal(n.get(t),t);n.max=3,e.equal(n.length,3);for(var t=0;97>t;t++)e.equal(n.get(t),void 0);for(var t=98;100>t;t++)e.equal(n.get(t),t);n.max="hello";for(var t=0;100>t;t++)n.set(t,t);e.equal(n.length,100);for(var t=0;100>t;t++)e.equal(n.get(t),t);n.max=3,e.equal(n.length,3);for(var t=0;97>t;t++)e.equal(n.get(t),void 0);for(var t=98;100>t;t++)e.equal(n.get(t),t);e.end()}),test("reset",function(e){var n=new LRU(10);n.set("a","A"),n.set("b","B"),n.reset(),e.equal(n.length,0),e.equal(n.max,10),e.equal(n.get("a"),void 0),e.equal(n.get("b"),void 0),e.end()}),test("dump",function(e){var n=new LRU(10),t=n.dump();e.equal(Object.keys(t).length,0,"nothing in dump for empty cache"),n.set("a","A");var t=n.dump();e.ok(t.a),e.equal(t.a.key,"a"),e.equal(t.a.value,"A"),e.equal(t.a.lu,0),n.set("b","B"),n.get("b"),t=n.dump(),e.ok(t.b),e.equal(t.b.key,"b"),e.equal(t.b.value,"B"),e.equal(t.b.lu,2),e.end()}),test("basic with weighed length",function(e){var n=new LRU({max:100,length:function(e){return e.size}});n.set("key",{val:"value",size:50}),e.equal(n.get("key").val,"value"),e.equal(n.get("nada"),void 0),e.equal(n.lengthCalculator(n.get("key")),50),e.equal(n.length,50),e.equal(n.max,100),e.end()}),test("weighed length item too large",function(e){var n=new LRU({max:10,length:function(e){return e.size}});e.equal(n.max,10),n.set("key",{val:"value",size:50}),e.equal(n.length,0),e.equal(n.get("key"),void 0),e.end()}),test("least recently set with weighed length",function(e){var n=new LRU({max:8,length:function(e){return e.length}});n.set("a","A"),n.set("b","BB"),n.set("c","CCC"),n.set("d","DDDD"),e.equal(n.get("d"),"DDDD"),e.equal(n.get("c"),"CCC"),e.equal(n.get("b"),void 0),e.equal(n.get("a"),void 0),e.end()}),test("lru recently gotten with weighed length",function(e){var n=new LRU({max:8,length:function(e){return e.length}});n.set("a","A"),n.set("b","BB"),n.set("c","CCC"),n.get("a"),n.get("b"),n.set("d","DDDD"),e.equal(n.get("c"),void 0),e.equal(n.get("d"),"DDDD"),e.equal(n.get("b"),"BB"),e.equal(n.get("a"),"A"),e.end()}),test("set returns proper booleans",function(e){var n=new LRU({max:5,length:function(e){return e.length}});e.equal(n.set("a","A"),!0),e.equal(n.set("b","donuts"),!1),e.equal(n.set("b","B"),!0),e.equal(n.set("c","CCCC"),!0),e.end()}),test("drop the old items",function(e){var n=new LRU({max:5,maxAge:50});n.set("a","A"),setTimeout(function(){n.set("b","b"),e.equal(n.get("a"),"A")},25),setTimeout(function(){n.set("c","C"),e.notOk(n.get("a"))},85),setTimeout(function(){e.notOk(n.get("b")),e.equal(n.get("c"),"C")},90),setTimeout(function(){e.notOk(n.get("c")),e.end()},155)}),test("individual item can have it's own maxAge",function(e){var n=new LRU({max:5,maxAge:50});n.set("a","A",20),setTimeout(function(){e.notOk(n.get("a")),e.end()},25)}),test("individual item can have it's own maxAge > cache's",function(e){var n=new LRU({max:5,maxAge:20});n.set("a","A",50),setTimeout(function(){e.equal(n.get("a"),"A"),e.end()},25)}),test("disposal function",function(e){var n=!1,t=new LRU({max:1,dispose:function(e,t){n=t}});t.set(1,1),t.set(2,2),e.equal(n,1),t.set(3,3),e.equal(n,2),t.reset(),e.equal(n,3),e.end()}),test("disposal function on too big of item",function(e){var n=!1,t=new LRU({max:1,length:function(e){return e.length},dispose:function(e,t){n=t}}),r=[1,2];e.equal(n,!1),t.set("obj",r),e.equal(n,r),e.end()}),test("has()",function(e){var n=new LRU({max:1,maxAge:10});n.set("foo","bar"),e.equal(n.has("foo"),!0),n.set("blu","baz"),e.equal(n.has("foo"),!1),e.equal(n.has("blu"),!0),setTimeout(function(){e.equal(n.has("blu"),!1),e.end()},15)}),test("stale",function(e){var n=new LRU({maxAge:10,stale:!0});n.set("foo","bar"),e.equal(n.get("foo"),"bar"),e.equal(n.has("foo"),!0),setTimeout(function(){e.equal(n.has("foo"),!1),e.equal(n.get("foo"),"bar"),e.equal(n.get("foo"),void 0),e.end()},15)}),test("lru update via set",function(e){var n=LRU({max:2});n.set("foo",1),n.set("bar",2),n.del("bar"),n.set("baz",3),n.set("qux",4),e.equal(n.get("foo"),void 0),e.equal(n.get("bar"),void 0),e.equal(n.get("baz"),3),e.equal(n.get("qux"),4),e.end()}),test("least recently set w/ peek",function(e){var n=new LRU(2);n.set("a","A"),n.set("b","B"),e.equal(n.peek("a"),"A"),n.set("c","C"),e.equal(n.get("c"),"C"),e.equal(n.get("b"),"B"),e.equal(n.get("a"),void 0),e.end()}),test("pop the least used item",function(e){var t,n=new LRU(3);n.set("a","A"),n.set("b","B"),n.set("c","C"),e.equal(n.length,3),e.equal(n.max,3),n.get("b","B"),t=n.pop(),e.equal(t.key,"a"),e.equal(t.value,"A"),e.equal(n.length,2),e.equal(n.max,3),t=n.pop(),e.equal(t.key,"c"),e.equal(t.value,"C"),e.equal(n.length,1),e.equal(n.max,3),t=n.pop(),e.equal(t.key,"b"),e.equal(t.value,"B"),e.equal(n.length,0),e.equal(n.max,3),t=n.pop(),e.equal(t,null),e.equal(n.length,0),e.equal(n.max,3),e.end()});
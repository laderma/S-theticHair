(function(){var e,n,t,r;r=require("./helpers"),n=r.extend,t=r.last,exports.Scope=e=function(){function e(n,t,r){this.parent=n,this.expressions=t,this.method=r,this.variables=[{name:"arguments",type:"arguments"}],this.positions={},this.parent||(e.root=this)}return e.root=null,e.prototype.add=function(e,n,t){return this.shared&&!t?this.parent.add(e,n,t):Object.prototype.hasOwnProperty.call(this.positions,e)?this.variables[this.positions[e]].type=n:this.positions[e]=this.variables.push({name:e,type:n})-1},e.prototype.namedMethod=function(){return this.method.name||!this.parent?this.method:this.parent.namedMethod()},e.prototype.find=function(e){return this.check(e)?!0:(this.add(e,"var"),!1)},e.prototype.parameter=function(e){return this.shared&&this.parent.check(e,!0)?void 0:this.add(e,"param")},e.prototype.check=function(e){var n;return!!(this.type(e)||(null!=(n=this.parent)?n.check(e):void 0))},e.prototype.temporary=function(e,n){return e.length>1?"_"+e+(n>1?n-1:""):"_"+(n+parseInt(e,36)).toString(36).replace(/\d/g,"a")},e.prototype.type=function(e){var n,t,r,a;for(a=this.variables,t=0,r=a.length;r>t;t++)if(n=a[t],n.name===e)return n.type;return null},e.prototype.freeVariable=function(e,n){var t,r;for(null==n&&(n=!0),t=0;this.check(r=this.temporary(e,t));)t++;return n&&this.add(r,"var",!0),r},e.prototype.assign=function(e,n){return this.add(e,{value:n,assigned:!0},!0),this.hasAssignments=!0},e.prototype.hasDeclarations=function(){return!!this.declaredVariables().length},e.prototype.declaredVariables=function(){var e,n,t,r,a,i;for(e=[],n=[],i=this.variables,r=0,a=i.length;a>r;r++)t=i[r],"var"===t.type&&("_"===t.name.charAt(0)?n:e).push(t.name);return e.sort().concat(n.sort())},e.prototype.assignedVariables=function(){var e,n,t,r,a;for(r=this.variables,a=[],n=0,t=r.length;t>n;n++)e=r[n],e.type.assigned&&a.push(""+e.name+" = "+e.type.value);return a},e}()}).call(this);
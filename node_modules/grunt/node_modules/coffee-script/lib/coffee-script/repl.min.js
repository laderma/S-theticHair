(function(){var e,n,t,r,a,i,o,s,u,l,c,f,d,h,p,m,g,b,v,_,y,k,w;k=process.openStdin(),w=process.stdout,n=require("./coffee-script"),v=require("readline"),m=require("util").inspect,s=require("vm").Script,t=require("module"),r="coffee> ",i="------> ",a="......> ",d=!1,"win32"!==process.platform&&(d=!process.env.NODE_DISABLE_COLORS),h=function(e){return w.write((e.stack||e.toString())+"\n")},e=/\s*([\w\.]+)(?:\.(\w*))$/,o=/(\w+)$/i,u=function(e){return c(e)||f(e)||[[],e]},c=function(n){var t,r,a,i,o,u,l,c;if(i=n.match(e)){t=i[0],o=i[1],l=i[2];try{c=s.runInThisContext(o)}catch(f){return}c=Object(c),u=Object.getOwnPropertyNames(c);for(a in c)~u.indexOf(c)&&u.push(a);return r=p(l,u),[r,l]}},f=function(e){var t,r,a,i,u,l,c;return r=null!=(c=e.match(o))?c[1]:void 0,""===e&&(r=""),null!=r?(l=s.runInThisContext("Object.getOwnPropertyNames(Object(this))"),a=function(){var e,t,r,a;for(r=n.RESERVED,a=[],e=0,t=r.length;t>e;e++)u=r[e],"__"!==u.slice(0,2)&&a.push(u);return a}(),i=l.concat(a),t=p(r,i),[t,r]):void 0},p=function(e,n){var t,r,a,i;for(i=[],r=0,a=n.length;a>r;r++)t=n[r],0===t.indexOf(e)&&i.push(t);return i},process.on("uncaughtException",h),l="",y=function(e){var t,i,o;if(e=e.replace(/(^|[\r\n]+)(\s*)##?(?:[^#\r\n][^\r\n]*|)($|[\r\n])/,"$1$2$3"),e=e.replace(/[\r\n]+$/,""),g)return l+=""+e+"\n",_.setPrompt(a),void _.prompt();if(!e.toString().trim()&&!l)return void _.prompt();if(t=l+=e,"\\"===t[t.length-1])return l=""+l.slice(0,-1)+"\n",_.setPrompt(a),void _.prompt();_.setPrompt(r),l="";try{o=global._,i=n.eval("_=("+t+"\n)",{filename:"repl",modulename:"repl"}),void 0===i&&(global._=o),_.output.write(""+m(i,!1,2,d)+"\n")}catch(s){h(s)}return _.prompt()},k.readable?(b="",_={prompt:function(){return w.write(this._prompt)},setPrompt:function(e){return this._prompt=e},input:k,output:w,on:function(){}},k.on("data",function(e){var n,t,r,a,i;if(b+=e,/\n/.test(b))for(t=b.split("\n"),b=t[t.length-1],i=t.slice(0,-1),r=0,a=i.length;a>r;r++)n=i[r],n&&(w.write(""+n+"\n"),y(n))}),k.on("end",function(){var e,n,t,r;for(r=b.trim().split("\n"),n=0,t=r.length;t>n;n++)e=r[n],e&&(w.write(""+e+"\n"),y(e));return w.write("\n"),process.exit(0)})):v.createInterface.length<3?(_=v.createInterface(k,u),k.on("data",function(e){return _.write(e)})):_=v.createInterface(k,w,u),g=!1,_.input.on("keypress",function(e,n){var t,a;if(n&&n.ctrl&&!n.meta&&!n.shift&&"v"===n.name)return t=_.cursor,_.output.cursorTo(0),_.output.clearLine(1),g=!g,!g&&l&&_._line(),l="",_.setPrompt(a=g?i:r),_.prompt(),_.output.cursorTo(a.length+(_.cursor=t))}),_.input.on("keypress",function(e,n){return g&&_.line&&n&&n.ctrl&&!n.meta&&!n.shift&&"d"===n.name?(g=!1,_._line()):void 0}),_.on("attemptClose",function(){return g?(g=!1,_.output.cursorTo(0),_.output.clearLine(1),void _._onLine(_.line)):l?(l="",_.output.write("\n"),_.setPrompt(r),_.prompt()):_.close()}),_.on("close",function(){return _.output.write("\n"),_.input.destroy()}),_.on("line",y),_.setPrompt(r),_.prompt()}).call(this);
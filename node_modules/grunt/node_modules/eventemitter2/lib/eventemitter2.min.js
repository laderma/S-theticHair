!function(e){function r(){this._events={},this._conf&&a.call(this,this._conf)}function a(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function i(e){this._events={},this.newListener=!1,a.call(this,e)}function s(e,n,t,r){if(!t)return[];var i,o,l,u,c,d,f,a=[],h=n.length,p=n[r],m=n[r+1];if(r===h&&t._listeners){if("function"==typeof t._listeners)return e&&e.push(t._listeners),[t];for(i=0,o=t._listeners.length;o>i;i++)e&&e.push(t._listeners[i]);return[t]}if("*"===p||"**"===p||t[p]){if("*"===p){for(l in t)"_listeners"!==l&&t.hasOwnProperty(l)&&(a=a.concat(s(e,n,t[l],r+1)));return a}if("**"===p){f=r+1===h||r+2===h&&"*"===m,f&&t._listeners&&(a=a.concat(s(e,n,t,h)));for(l in t)"_listeners"!==l&&t.hasOwnProperty(l)&&("*"===l||"**"===l?(t[l]._listeners&&!f&&(a=a.concat(s(e,n,t[l],h))),a=a.concat(s(e,n,t[l],r))):a=l===m?a.concat(s(e,n,t[l],r+2)):a.concat(s(e,n,t[l],r)));return a}a=a.concat(s(e,n,t[p],r+1))}if(u=t["*"],u&&s(e,n,u,r+1),c=t["**"])if(h>r){c._listeners&&s(e,n,c,h);for(l in c)"_listeners"!==l&&c.hasOwnProperty(l)&&(l===m?s(e,n,c[l],r+2):l===p?s(e,n,c[l],r+1):(d={},d[l]=c[l],s(e,n,{"**":d},r+1)))}else c._listeners?s(e,n,c,h):c["*"]&&c["*"]._listeners&&s(e,n,c["*"],h);return a}function o(e,r){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var a=0,i=e.length;i>a+1;a++)if("**"===e[a]&&"**"===e[a+1])return;for(var s=this.listenerTree,o=e.shift();o;){if(s[o]||(s[o]={}),s=s[o],0===e.length){if(s._listeners){if("function"==typeof s._listeners)s._listeners=[s._listeners,r];else if(n(s._listeners)&&(s._listeners.push(r),!s._listeners.warned)){var l=t;"undefined"!=typeof this._events.maxListeners&&(l=this._events.maxListeners),l>0&&s._listeners.length>l&&(s._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",s._listeners.length),console.trace())}}else s._listeners=r;return!0}o=e.shift()}return!0}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},t=10;i.prototype.delimiter=".",i.prototype.setMaxListeners=function(e){this._events||r.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},i.prototype.event="",i.prototype.once=function(e,n){return this.many(e,1,n),this},i.prototype.many=function(e,n,t){function a(){0===--n&&r.off(e,a),t.apply(this,arguments)}var r=this;if("function"!=typeof t)throw new Error("many only accepts instances of Function");return a._origin=t,this.on(e,a),r},i.prototype.emit=function(){this._events||r.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,t=new Array(n-1),a=1;n>a;a++)t[a-1]=arguments[a];for(a=0,n=this._all.length;n>a;a++)this.event=e,this._all[a].apply(this,t)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var i;if(this.wildcard){i=[];var o="string"==typeof e?e.split(this.delimiter):e.slice();s.call(this,i,o,this.listenerTree,0)}else i=this._events[e];if("function"==typeof i){if(this.event=e,1===arguments.length)i.call(this);else if(arguments.length>1)switch(arguments.length){case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,t=new Array(n-1),a=1;n>a;a++)t[a-1]=arguments[a];i.apply(this,t)}return!0}if(i){for(var n=arguments.length,t=new Array(n-1),a=1;n>a;a++)t[a-1]=arguments[a];for(var l=i.slice(),a=0,n=l.length;n>a;a++)this.event=e,l[a].apply(this,t);return l.length>0||!!this._all}return!!this._all},i.prototype.on=function(e,a){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof a)throw new Error("on only accepts instances of Function");if(this._events||r.call(this),this.emit("newListener",e,a),this.wildcard)return o.call(this,e,a),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],a];else if(n(this._events[e])&&(this._events[e].push(a),!this._events[e].warned)){var i=t;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=a;return this},i.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},i.prototype.addListener=i.prototype.on,i.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var r,a=[];if(this.wildcard){var i="string"==typeof e?e.split(this.delimiter):e.slice();a=s.call(this,null,i,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],a.push({_listeners:r})}for(var o=0;o<a.length;o++){var l=a[o];if(r=l._listeners,n(r)){for(var u=-1,c=0,d=r.length;d>c;c++)if(r[c]===t||r[c].listener&&r[c].listener===t||r[c]._origin&&r[c]._origin===t){u=c;break}if(0>u)continue;return this.wildcard?l._listeners.splice(u,1):this._events[e].splice(u,1),0===r.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this}(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e])}return this},i.prototype.offAny=function(e){var r,n=0,t=0;if(e&&this._all&&this._all.length>0){for(r=this._all,n=0,t=r.length;t>n;n++)if(e===r[n])return r.splice(n,1),this}else this._all=[];return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||r.call(this),this;if(this.wildcard)for(var n="string"==typeof e?e.split(this.delimiter):e.slice(),t=s.call(this,null,n,this.listenerTree,0),a=0;a<t.length;a++){var i=t[a];i._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},i.prototype.listeners=function(e){if(this.wildcard){var t=[],a="string"==typeof e?e.split(this.delimiter):e.slice();return s.call(this,t,a,this.listenerTree,0),t}return this._events||r.call(this),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},i.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof exports?exports.EventEmitter2=i:window.EventEmitter2=i}();
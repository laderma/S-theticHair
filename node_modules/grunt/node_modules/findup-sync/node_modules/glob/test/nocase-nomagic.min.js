var fs=require("fs"),test=require("tap").test,glob=require("../");test("mock fs",function(e){function a(e){var n;switch(e.toLowerCase()){case"/tmp":case"/tmp/":n={isDirectory:function(){return!0}};break;case"/tmp/a":n={isDirectory:function(){return!1}}}return n}function o(e){var n;switch(e.toLowerCase()){case"/tmp":case"/tmp/":n=["a","A"];break;case"/":n=["tmp","tMp","tMP","TMP"]}return n}var n=fs.stat,t=fs.statSync,r=fs.readdir,i=fs.readdirSync;fs.stat=function(e,t){var r=a(e);r?process.nextTick(function(){t(null,r)}):n.call(fs,e,t)},fs.statSync=function(e){return a(e)||t.call(fs,e)},fs.readdir=function(e,n){var t=o(e);t?process.nextTick(function(){n(null,t)}):r.call(fs,e,n)},fs.readdirSync=function(e){return o(e)||i.call(fs,e)},e.pass("mocked"),e.end()}),test("nocase, nomagic",function(e){var n=2,t=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/a",{nocase:!0},function(r,i){if(r)throw r;e.same(i.sort(),t),0===--n&&e.end()}),glob("/tmp/A",{nocase:!0},function(r,i){if(r)throw r;e.same(i.sort(),t),0===--n&&e.end()})}),test("nocase, with some magic",function(e){e.plan(2);var n=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/*",{nocase:!0},function(t,r){if(t)throw t;e.same(r.sort(),n)}),glob("/tmp/*",{nocase:!0},function(t,r){if(t)throw t;e.same(r.sort(),n)})});
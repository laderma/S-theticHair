"use strict";function gRequire(n){return grunt[n]=require("./grunt/"+n)}function gExpose(n,e,t){grunt[t||e]=n[e].bind(n)}var path=require("path");require("coffee-script");var grunt=module.exports={},util=require("grunt-legacy-util");grunt.util=util,grunt.util.task=require("./util/task");var Log=require("grunt-legacy-log").Log,log=new Log({grunt:grunt});grunt.log=log,gRequire("template"),gRequire("event");var fail=gRequire("fail");gRequire("file");var option=gRequire("option"),config=gRequire("config"),task=gRequire("task"),help=gRequire("help");gRequire("cli");var verbose=grunt.verbose=log.verbose;grunt["package"]=require("../package.json"),grunt.version=grunt["package"].version,gExpose(task,"registerTask"),gExpose(task,"registerMultiTask"),gExpose(task,"registerInitTask"),gExpose(task,"renameTask"),gExpose(task,"loadTasks"),gExpose(task,"loadNpmTasks"),gExpose(config,"init","initConfig"),gExpose(fail,"warn"),gExpose(fail,"fatal"),grunt.tasks=function(n,e,t){option.init(e);var r,a;if(option("version"))return log.writeln("grunt v"+grunt.version),void(option("verbose")&&(verbose.writeln("Install path: "+path.resolve(__dirname,"..")),grunt.log.muted=!0,grunt.task.init([],{help:!0}),grunt.log.muted=!1,r=Object.keys(grunt.task._tasks).sort(),verbose.writeln("Available tasks: "+r.join(" ")),a=[],Object.keys(grunt.cli.optlist).forEach(function(n){var e=grunt.cli.optlist[n];a.push("--"+(e.negate?"no-":"")+n),e["short"]&&a.push("-"+e["short"])}),verbose.writeln("Available options: "+a.join(" "))));if(log.initColors(),option("help"))return void help.display();verbose.header("Initializing").writeflags(option.flags(),"Command-line options");var i=n&&n.length>0;n=task.parseArgs([i?n:"default"]),task.init(n),verbose.writeln(),i||verbose.writeln("No tasks specified, running default tasks."),verbose.writeflags(n,"Running tasks");var s=function(n){fail.fatal(n,fail.code.TASK_FAILURE)};process.on("uncaughtException",s),task.options({error:function(n){fail.warn(n,fail.code.TASK_FAILURE)},done:function(){process.removeListener("uncaughtException",s),fail.report(),t?t():util.exit(0)}}),n.forEach(function(n){task.run(n)}),task.start({asyncDone:!0})};
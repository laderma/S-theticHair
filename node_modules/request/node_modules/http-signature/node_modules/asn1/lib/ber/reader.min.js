function Reader(e){if(!e||!Buffer.isBuffer(e))throw new TypeError("data must be a node Buffer");this._buf=e,this._size=e.length,this._len=0,this._offset=0;var n=this;this.__defineGetter__("length",function(){return n._len}),this.__defineGetter__("offset",function(){return n._offset}),this.__defineGetter__("remain",function(){return n._size-n._offset}),this.__defineGetter__("buffer",function(){return n._buf.slice(n._offset)})}var assert=require("assert"),ASN1=require("./types"),errors=require("./errors"),newInvalidAsn1Error=errors.newInvalidAsn1Error;Reader.prototype.readByte=function(e){if(this._size-this._offset<1)return null;var n=255&this._buf[this._offset];return e||(this._offset+=1),n},Reader.prototype.peek=function(){return this.readByte(!0)},Reader.prototype.readLength=function(e){if(void 0===e&&(e=this._offset),e>=this._size)return null;var n=255&this._buf[e++];if(null===n)return null;if(128==(128&n)){if(n&=127,0==n)throw newInvalidAsn1Error("Indefinite length not supported");if(n>4)throw newInvalidAsn1Error("encoding too long");if(this._size-e<n)return null;this._len=0;for(var t=0;n>t;t++)this._len=(this._len<<8)+(255&this._buf[e++])}else this._len=n;return e},Reader.prototype.readSequence=function(e){var n=this.peek();if(null===n)return null;if(void 0!==e&&e!==n)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+n.toString(16));var t=this.readLength(this._offset+1);return null===t?null:(this._offset=t,n)},Reader.prototype.readInt=function(){return this._readTag(ASN1.Integer)},Reader.prototype.readBoolean=function(){return 0===this._readTag(ASN1.Boolean)?!1:!0},Reader.prototype.readEnumeration=function(){return this._readTag(ASN1.Enumeration)},Reader.prototype.readString=function(e,n){e||(e=ASN1.OctetString);var t=this.peek();if(null===t)return null;if(t!==e)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+t.toString(16));var r=this.readLength(this._offset+1);if(null===r)return null;if(this.length>this._size-r)return null;if(this._offset=r,0===this.length)return"";var i=this._buf.slice(this._offset,this._offset+this.length);return this._offset+=this.length,n?i:i.toString("utf8")},Reader.prototype.readOID=function(e){e||(e=ASN1.OID);var n=this.peek();if(null===n)return null;if(n!==e)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+n.toString(16));var t=this.readLength(this._offset+1);if(null===t)return null;if(this.length>this._size-t)return null;this._offset=t;for(var r=[],i=0,a=0;a<this.length;a++){var o=255&this._buf[this._offset++];i<<=7,i+=127&o,0==(128&o)&&(r.push(i),i=0)}return i=r.shift(),r.unshift(i%40),r.unshift(i/40>>0),r.join(".")},Reader.prototype._readTag=function(e){assert.ok(void 0!==e);var n=this.peek();if(null===n)return null;if(n!==e)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+n.toString(16));var t=this.readLength(this._offset+1);if(null===t)return null;if(this.length>4)throw newInvalidAsn1Error("Integer too long: "+this.length);if(this.length>this._size-t)return null;this._offset=t;var r=this._buf[this._offset++],i=0;i=127&r;for(var a=1;a<this.length;a++)i<<=8,i|=255&this._buf[this._offset++];return 128==(128&r)&&(i=-i),i},module.exports=Reader;
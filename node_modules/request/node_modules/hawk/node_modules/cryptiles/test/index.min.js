var Lab=require("lab"),Cryptiles=require("../lib"),internals={},expect=Lab.expect,before=Lab.before,after=Lab.after,describe=Lab.experiment,it=Lab.test;describe("Cryptiles",function(){describe("#randomString",function(){it("should generate the right length string",function(e){for(var n=1;1e3>=n;++n)expect(Cryptiles.randomString(n).length).to.equal(n);e()}),it("returns an error on invalid bits size",function(e){expect(Cryptiles.randomString(1e20).message).to.equal("Failed generating random bits: Argument #1 must be number > 0"),e()})}),describe("#randomBits",function(){it("returns an error on invalid input",function(e){expect(Cryptiles.randomBits(0).message).to.equal("Invalid random bits count"),e()})}),describe("#fixedTimeComparison",function(){var e=Cryptiles.randomString(5e4),n=Cryptiles.randomString(15e4);it("should take the same amount of time comparing different string sizes",function(t){var r=Date.now();Cryptiles.fixedTimeComparison(n,e);var i=Date.now()-r;r=Date.now(),Cryptiles.fixedTimeComparison(n,n);var a=Date.now()-r;expect(a-i).to.be.within(-20,20),t()}),it("should return true for equal strings",function(n){expect(Cryptiles.fixedTimeComparison(e,e)).to.equal(!0),n()}),it("should return false for different strings (size, a < b)",function(n){expect(Cryptiles.fixedTimeComparison(e,e+"x")).to.equal(!1),n()}),it("should return false for different strings (size, a > b)",function(n){expect(Cryptiles.fixedTimeComparison(e+"x",e)).to.equal(!1),n()}),it("should return false for different strings (size, a = b)",function(n){expect(Cryptiles.fixedTimeComparison(e+"x",e+"y")).to.equal(!1),n()}),it("should return false when not a string",function(e){expect(Cryptiles.fixedTimeComparison("x",null)).to.equal(!1),e()})})});
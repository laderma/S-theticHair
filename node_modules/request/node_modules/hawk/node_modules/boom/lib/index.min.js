var Http=require("http"),NodeUtil=require("util"),Hoek=require("hoek"),internals={};exports=module.exports=internals.Boom=function(){if(Hoek.assert(this.constructor===internals.Boom,"Error must be instantiated using new"),Error.call(this),this.isBoom=!0,this.response={code:0,payload:{},headers:{}},arguments[0]instanceof Error){var n=arguments[0];this.data=n,this.response.code=n.code||500,n.message&&(this.message=n.message)}else{var t=arguments[0],r=arguments[1];Hoek.assert(!isNaN(parseFloat(t))&&isFinite(t)&&t>=400,"First argument must be a number (400+)"),this.response.code=t,r&&(this.message=r)}return this.reformat(),this},NodeUtil.inherits(internals.Boom,Error),internals.Boom.prototype.reformat=function(){this.response.payload.code=this.response.code,this.response.payload.error=Http.STATUS_CODES[this.response.code]||"Unknown",this.message&&(this.response.payload.message=Hoek.escapeHtml(this.message))},internals.Boom.badRequest=function(e){return new internals.Boom(400,e)},internals.Boom.unauthorized=function(e,n,t){var r=new internals.Boom(401,e);if(!n)return r;var i="";if("string"==typeof n){if(i=n,t)for(var a=Object.keys(t),o=0,s=a.length;s>o;++o){o&&(i+=",");var u=t[a[o]];(null===u||void 0===u)&&(u=""),i+=" "+a[o]+'="'+Hoek.escapeHeaderAttribute(u.toString())+'"'}e?(t&&(i+=","),i+=' error="'+Hoek.escapeHeaderAttribute(e)+'"'):r.isMissing=!0}else for(var l=n,o=0,s=l.length;s>o;++o)o&&(i+=", "),i+=l[o];return r.response.headers["WWW-Authenticate"]=i,r},internals.Boom.clientTimeout=function(e){return new internals.Boom(408,e)},internals.Boom.serverTimeout=function(e){return new internals.Boom(503,e)},internals.Boom.forbidden=function(e){return new internals.Boom(403,e)},internals.Boom.notFound=function(e){return new internals.Boom(404,e)},internals.Boom.internal=function(e,n){var t=new internals.Boom(500,e);return n&&n.stack?(t.trace=n.stack.split("\n"),t.outterTrace=Hoek.displayStack(1)):t.trace=Hoek.displayStack(1),t.data=n,t.response.payload.message="An internal server error occurred",t},internals.Boom.passThrough=function(e,n,t,r){var i=new internals.Boom(500,"Pass-through");return i.data={code:e,payload:n,type:t},i.response.code=e,i.response.type=t,i.response.headers=r,i.response.payload=n,i};
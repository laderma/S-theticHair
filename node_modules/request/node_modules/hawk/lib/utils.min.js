var Hoek=require("hoek"),Sntp=require("sntp"),Boom=require("boom"),internals={};internals["import"]=function(){for(var e in Hoek)Hoek.hasOwnProperty(e)&&(exports[e]=Hoek[e])},internals["import"](),exports.version=function(){return exports.loadPackage(__dirname+"/..").version},exports.parseHost=function(e,n){n=n?n.toLowerCase():"host";var t=e.headers[n];if(!t)return null;var r;r="["===t[0]?/^(?:(?:\r\n)?\s)*(\[[^\]]+\])(?::(\d+))?(?:(?:\r\n)?\s)*$/:/^(?:(?:\r\n)?\s)*([^:]+)(?::(\d+))?(?:(?:\r\n)?\s)*$/;var a=t.match(r);return a&&3===a.length&&a[1]?{name:a[1],port:a[2]?a[2]:e.connection&&e.connection.encrypted?443:80}:null},exports.parseContentType=function(e){return e?e.split(";")[0].trim().toLowerCase():""},exports.parseRequest=function(e,n){if(!e.headers)return e;if(!n.host||!n.port){var t=exports.parseHost(e,n.hostHeaderName);if(!t)return new Error("Invalid Host header")}var r={method:e.method,url:e.url,host:n.host||t.name,port:n.port||t.port,authorization:e.headers.authorization,contentType:e.headers["content-type"]||""};return r},exports.now=function(){return Sntp.now()},exports.parseAuthorizationHeader=function(e,n){if(n=n||["id","ts","nonce","hash","ext","mac","app","dlg"],!e)return Boom.unauthorized(null,"Hawk");var t=e.match(/^(\w+)(?:\s+(.*))?$/);if(!t)return Boom.badRequest("Invalid header syntax");var r=t[1];if("hawk"!==r.toLowerCase())return Boom.unauthorized(null,"Hawk");var a=t[2];if(!a)return Boom.badRequest("Invalid header syntax");var i={},s="",o=a.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function(e,t,r){return-1===n.indexOf(t)?void(s="Unknown attribute: "+t):null===r.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/)?void(s="Bad attribute value: "+t):i.hasOwnProperty(t)?void(s="Duplicate attribute: "+t):(i[t]=r,"")});return""!==o?Boom.badRequest(s||"Bad header format"):i},exports.unauthorized=function(e){return Boom.unauthorized(e,"Hawk")};
function promote(e,n){if(0==e[n].length)return e[n]={};var t={};for(var r in e[n])hasOwnProperty.call(e[n],r)&&(t[r]=e[n][r]);return e[n]=t,t}function parse(e,n,t,r){var a=e.shift();if(!Object.getOwnPropertyDescriptor(Object.prototype,t))if(a){var i=n[t]=n[t]||[];"]"==a?isArray(i)?""!=r&&i.push(r):"object"==typeof i?i[objectKeys(i).length]=r:i=n[t]=[n[t],r]:~indexOf(a,"]")?(a=a.substr(0,a.length-1),!isint.test(a)&&isArray(i)&&(i=promote(n,t)),parse(e,i,a,r)):(!isint.test(a)&&isArray(i)&&(i=promote(n,t)),parse(e,i,a,r))}else isArray(n[t])?n[t].push(r):"object"==typeof n[t]?n[t]=r:"undefined"==typeof n[t]?n[t]=r:n[t]=[n[t],r]}function merge(e,n,t){if(~indexOf(n,"]")){var r=n.split("[");r.length;parse(r,e,"base",t)}else{if(!isint.test(n)&&isArray(e.base)){var s={};for(var o in e.base)s[o]=e.base[o];e.base=s}set(e.base,n,t)}return e}function compact(e){if("object"!=typeof e)return e;if(isArray(e)){var n=[];for(var t in e)hasOwnProperty.call(e,t)&&n.push(e[t]);return n}for(var r in e)e[r]=compact(e[r]);return e}function parseObject(e){var n={base:{}};return forEach(objectKeys(e),function(t){merge(n,t,e[t])}),compact(n.base)}function parseString(e){var n=reduce(String(e).split("&"),function(e,n){var t=indexOf(n,"="),r=lastBraceInKey(n),a=n.substr(0,r||t),i=n.substr(r||t,n.length),i=i.substr(indexOf(i,"=")+1,i.length);return""==a&&(a=n,i=""),""==a?e:merge(e,decode(a),decode(i))},{base:{}}).base;return compact(n)}function stringifyString(e,n){if(!n)throw new TypeError("stringify expects an object");return n+"="+encodeURIComponent(e)}function stringifyArray(e,n){var t=[];if(!n)throw new TypeError("stringify expects an object");for(var r=0;r<e.length;r++)t.push(stringify(e[r],n+"["+r+"]"));return t.join("&")}function stringifyObject(e,n){for(var a,t=[],r=objectKeys(e),i=0,s=r.length;s>i;++i)a=r[i],""!=a&&(null==e[a]?t.push(encodeURIComponent(a)+"="):t.push(stringify(e[a],n?n+"["+encodeURIComponent(a)+"]":encodeURIComponent(a))));return t.join("&")}function set(e,n,t){var r=e[n];Object.getOwnPropertyDescriptor(Object.prototype,n)||(void 0===r?e[n]=t:isArray(r)?r.push(t):e[n]=[r,t])}function lastBraceInKey(e){for(var t,r,n=e.length,a=0;n>a;++a)if(r=e[a],"]"==r&&(t=!1),"["==r&&(t=!0),"="==r&&!t)return a}function decode(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(n){return e}}var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,indexOf="function"==typeof Array.prototype.indexOf?function(e,n){return e.indexOf(n)}:function(e,n){for(var t=0;t<e.length;t++)if(e[t]===n)return t;return-1},isArray=Array.isArray||function(e){return"[object Array]"==toString.call(e)},objectKeys=Object.keys||function(e){var n=[];for(var t in e)e.hasOwnProperty(t)&&n.push(t);return n},forEach="function"==typeof Array.prototype.forEach?function(e,n){return e.forEach(n)}:function(e,n){for(var t=0;t<e.length;t++)n(e[t])},reduce=function(e,n,t){if("function"==typeof e.reduce)return e.reduce(n,t);for(var r=t,a=0;a<e.length;a++)r=n(r,e[a]);return r},isint=/^[0-9]+$/;exports.parse=function(e){return null==e||""==e?{}:"object"==typeof e?parseObject(e):parseString(e)};var stringify=exports.stringify=function(e,n){return isArray(e)?stringifyArray(e,n):"[object Object]"==toString.call(e)?stringifyObject(e,n):"string"==typeof e?stringifyString(e,n):n+"="+encodeURIComponent(String(e))};
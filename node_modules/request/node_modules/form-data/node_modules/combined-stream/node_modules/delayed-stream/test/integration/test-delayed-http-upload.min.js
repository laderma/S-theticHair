var common=require("../common"),assert=common.assert,DelayedStream=common.DelayedStream,http=require("http"),UPLOAD=new Buffer(10485760),server=http.createServer(function(e,n){var t=DelayedStream.create(e,{maxDataSize:UPLOAD.length});setTimeout(function(){n.writeHead(200),t.pipe(n)},10)});server.listen(common.PORT,function(){var e=http.request({method:"POST",port:common.PORT});e.write(UPLOAD),e.end(),e.on("response",function(e){var n=0;e.on("data",function(e){n+=e.length}).on("end",function(){assert.equal(n,UPLOAD.length),server.close()})})});
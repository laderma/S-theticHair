var util=require("util"),driver=require("websocket-driver"),API=require("./websocket/api"),WebSocket=function(e,n,t,r,a){a=a||{},this._stream=n,this._driver=driver.http(e,{maxLength:a.maxLength,protocols:r});var i=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var o=function(){i._stream.removeListener("data",o)};this._stream.on("data",o),API.call(this,a),process.nextTick(function(){i._driver.start(),i._driver.io.write(t)})}};util.inherits(WebSocket,API),WebSocket.isWebSocket=function(e){return driver.isWebSocket(e)},WebSocket.validateOptions=function(e,n){driver.validateOptions(e,n)},WebSocket.WebSocket=WebSocket,WebSocket.Client=require("./websocket/client"),WebSocket.EventSource=require("./eventsource"),module.exports=WebSocket;
function JSDeflater(n){function _e(n,e){$n=n,Wn=0,Jn(e);var i,r=new Array(1024),a=[],t=0;for(i=0;1024>i;i++)r[i]=0;for(;(i=pe(r,0,r.length))>0;){var s=new Buffer(r.slice(0,i));a.push(s),t+=s.length}if(1==a.length)return a[0];var l=new Buffer(t),o=0;for(i=0;i<a.length;i++)a[i].copy(l,o),o+=a[i].length;return l}var L,K,$,W,O,R,j,G,V,q,Z,Y,J,Q,X,nn,en,rn,an,tn,sn,ln,on,un,hn,cn,dn,fn,gn,mn,pn,bn,Hn,kn,vn,Sn,wn,zn,Mn,Dn,yn,Fn,Tn,En,An,Cn,Bn,xn,Un,In,_n,Pn,Ln,Kn,$n,Wn,e=32768,r=0,a=1,t=2,i=6,s=!0,l=32768,o=64,u=8192,h=2*e,c=3,d=258,f=16,g=8192,m=13,p=g,b=1<<m,H=b-1,k=e-1,v=0,S=4096,w=d+c+1,z=e-w,M=1,D=15,y=7,F=29,T=256,E=256,A=T+1+F,C=30,B=19,x=16,U=17,I=18,_=2*A+1,P=parseInt((m+c-1)/c),N=null,Nn=function(){this.fc=0,this.dl=0},On=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},Rn=function(n,e,r,a){this.good_length=n,this.max_lazy=e,this.nice_length=r,this.max_chain=a},jn=function(){this.next=null,this.len=0,this.ptr=new Array(u),this.off=0},Gn=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0),Vn=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),qn=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7),Zn=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),Yn=new Array(new Rn(0,0,0,0),new Rn(4,4,8,4),new Rn(4,5,16,8),new Rn(4,6,32,32),new Rn(4,4,16,16),new Rn(8,16,32,32),new Rn(8,16,128,128),new Rn(8,32,128,256),new Rn(32,128,258,1024),new Rn(32,258,258,4096)),Jn=function(n){var e;if(n?1>n?n=1:n>9&&(n=9):n=i,dn=n,W=!1,on=!1,null==N){for(L=K=$=null,N=new Array(u),G=new Array(h),V=new Array(p),q=new Array(l+o),Z=new Array(1<<f),mn=new Array(_),e=0;_>e;e++)mn[e]=new Nn;for(pn=new Array(2*C+1),e=0;2*C+1>e;e++)pn[e]=new Nn;for(bn=new Array(A+2),e=0;A+2>e;e++)bn[e]=new Nn;for(Hn=new Array(C),e=0;C>e;e++)Hn[e]=new Nn;for(kn=new Array(2*B+1),e=0;2*B+1>e;e++)kn[e]=new Nn;vn=new On,Sn=new On,wn=new On,zn=new Array(D+1),Mn=new Array(2*A+1),Fn=new Array(2*A+1),Tn=new Array(d-c+1),En=new Array(512),An=new Array(F),Cn=new Array(C),Bn=new Array(parseInt(g/8))}},Xn=function(n){n.next=L,L=n},ne=function(){var n;return null!=L?(n=L,L=L.next):n=new jn,n.next=null,n.len=n.off=0,n},ee=function(n){return Z[e+n]},re=function(n,r){return Z[e+n]=r},ae=function(n){N[R+O++]=n,R+O==u&&Ie()},te=function(n){n&=65535,u-2>R+O?(N[R+O++]=255&n,N[R+O++]=n>>>8):(ae(255&n),ae(n>>>8))},ie=function(){X=(X<<P^255&G[sn+c-1])&H,nn=ee(X),Z[sn&k]=nn,re(X,sn)},se=function(n,e){Be(e[n].fc,e[n].dl)},le=function(n){return 255&(256>n?En[n]:En[256+(n>>7)])},oe=function(n,e,r){return n[e].fc<n[r].fc||n[e].fc==n[r].fc&&Fn[e]<=Fn[r]},ue=function(n,e,r){var a;for(a=0;r>a&&Wn<$n.length;a++)n[e+a]=255&$n[Wn++];return a},he=function(){var n;for(n=0;b>n;n++)Z[e+n]=0;if(cn=Yn[dn].max_lazy,fn=Yn[dn].good_length,s||(gn=Yn[dn].nice_length),hn=Yn[dn].max_chain,sn=0,Q=0,un=ue(G,0,2*e),0>=un)return on=!0,void(un=0);for(on=!1;w>un&&!on;)de();for(X=0,n=0;c-1>n;n++)X=(X<<P^255&G[n])&H},ce=function(n){var a,t,e=hn,r=sn,i=tn,l=sn>z?sn-z:v,o=sn+d,u=G[r+i-1],h=G[r+i];tn>=fn&&(e>>=2);do if(a=n,G[a+i]==h&&G[a+i-1]==u&&G[a]==G[r]&&G[++a]==G[r+1]){r+=2,a++;do;while(G[++r]==G[++a]&&G[++r]==G[++a]&&G[++r]==G[++a]&&G[++r]==G[++a]&&G[++r]==G[++a]&&G[++r]==G[++a]&&G[++r]==G[++a]&&G[++r]==G[++a]&&o>r);if(t=d-(o-r),r=o-d,t>i){if(ln=n,i=t,s){if(t>=d)break}else if(t>=gn)break;u=G[r+i-1],h=G[r+i]}}while((n=Z[n&k])>l&&0!=--e);return i},de=function(){var n,r,a=h-un-sn;if(-1==a)a--;else if(sn>=e+z){for(n=0;e>n;n++)G[n]=G[n+e];for(ln-=e,sn-=e,Q-=e,n=0;b>n;n++)r=ee(n),re(n,r>=e?r-e:v);for(n=0;e>n;n++)r=Z[n],Z[n]=r>=e?r-e:v;a+=e}on||(n=ue(G,sn+un,a),0>=n?on=!0:un+=n)},fe=function(){for(;0!=un&&null==K;){var n;if(ie(),nn!=v&&z>=sn-nn&&(an=ce(nn),an>un&&(an=un)),an>=c)if(n=Ee(sn-ln,an-c),un-=an,cn>=an){an--;do sn++,ie();while(0!=--an);sn++}else sn+=an,an=0,X=255&G[sn],X=(X<<P^255&G[sn+1])&H;else n=Ee(0,255&G[sn]),un--,sn++;for(n&&(Te(0),Q=sn);w>un&&!on;)de()}},ge=function(){for(;0!=un&&null==K;){if(ie(),tn=an,en=ln,an=c-1,nn!=v&&cn>tn&&z>=sn-nn&&(an=ce(nn),an>un&&(an=un),an==c&&sn-ln>S&&an--),tn>=c&&tn>=an){var n;n=Ee(sn-1-en,tn-c),un-=tn-1,tn-=2;do sn++,ie();while(0!=--tn);rn=0,an=c-1,sn++,n&&(Te(0),Q=sn)}else 0!=rn?(Ee(0,255&G[sn-1])&&(Te(0),Q=sn),sn++,un--):(rn=1,sn++,un--);for(;w>un&&!on;)de()}},me=function(){on||(Y=0,J=0,He(),he(),K=null,O=0,R=0,rn=0,3>=dn?(tn=c-1,an=0):(an=c-1,rn=0,rn=0),j=!1)},pe=function(n,e,r){var a;return W||(me(),W=!0,0!=un)?(a=be(n,e,r))==r?r:j?a:(3>=dn?fe():ge(),0==un&&(0!=rn&&Ee(0,255&G[sn-1]),Te(1),j=!0),a+be(n,a+e,r-a)):(j=!0,0)},be=function(n,e,r){var a,t,i;for(a=0;null!=K&&r>a;){for(t=r-a,t>K.len&&(t=K.len),i=0;t>i;i++)n[e+a+i]=K.ptr[K.off+i];if(K.off+=t,K.len-=t,a+=t,0==K.len){var s;s=K,K=K.next,Xn(s)}}if(a==r)return a;if(O>R){for(t=r-a,t>O-R&&(t=O-R),i=0;t>i;i++)n[e+a+i]=N[R+i];R+=t,a+=t,O==R&&(O=R=0)}return a},He=function(){var n,e,r,a,t;if(0==Hn[0].dl){for(vn.dyn_tree=mn,vn.static_tree=bn,vn.extra_bits=Gn,vn.extra_base=T+1,vn.elems=A,vn.max_length=D,vn.max_code=0,Sn.dyn_tree=pn,Sn.static_tree=Hn,Sn.extra_bits=Vn,Sn.extra_base=0,Sn.elems=C,Sn.max_length=D,Sn.max_code=0,wn.dyn_tree=kn,wn.static_tree=null,wn.extra_bits=qn,wn.extra_base=0,wn.elems=B,wn.max_length=y,wn.max_code=0,r=0,a=0;F-1>a;a++)for(An[a]=r,n=0;n<1<<Gn[a];n++)Tn[r++]=a;for(Tn[r-1]=a,t=0,a=0;16>a;a++)for(Cn[a]=t,n=0;n<1<<Vn[a];n++)En[t++]=a;for(t>>=7;C>a;a++)for(Cn[a]=t<<7,n=0;n<1<<Vn[a]-7;n++)En[256+t++]=a;for(e=0;D>=e;e++)zn[e]=0;for(n=0;143>=n;)bn[n++].dl=8,zn[8]++;for(;255>=n;)bn[n++].dl=9,zn[9]++;for(;279>=n;)bn[n++].dl=7,zn[7]++;for(;287>=n;)bn[n++].dl=8,zn[8]++;for(we(bn,A+1),n=0;C>n;n++)Hn[n].dl=5,Hn[n].fc=xe(n,5);ke()}},ke=function(){var n;for(n=0;A>n;n++)mn[n].fc=0;for(n=0;C>n;n++)pn[n].fc=0;for(n=0;B>n;n++)kn[n].fc=0;mn[E].fc=1,Ln=Kn=0,xn=Un=In=0,_n=0,Pn=1},ve=function(n,e){for(var r=Mn[e],a=e<<1;Dn>=a&&(Dn>a&&oe(n,Mn[a+1],Mn[a])&&a++,!oe(n,r,Mn[a]));)Mn[e]=Mn[a],e=a,a<<=1;Mn[e]=r},Se=function(n){var l,o,u,h,c,d,e=n.dyn_tree,r=n.extra_bits,a=n.extra_base,t=n.max_code,i=n.max_length,s=n.static_tree,f=0;for(h=0;D>=h;h++)zn[h]=0;for(e[Mn[yn]].dl=0,l=yn+1;_>l;l++)o=Mn[l],h=e[e[o].dl].dl+1,h>i&&(h=i,f++),e[o].dl=h,o>t||(zn[h]++,c=0,o>=a&&(c=r[o-a]),d=e[o].fc,Ln+=d*(h+c),null!=s&&(Kn+=d*(s[o].dl+c)));if(0!=f){do{for(h=i-1;0==zn[h];)h--;zn[h]--,zn[h+1]+=2,zn[i]--,f-=2}while(f>0);for(h=i;0!=h;h--)for(o=zn[h];0!=o;)u=Mn[--l],u>t||(e[u].dl!=h&&(Ln+=(h-e[u].dl)*e[u].fc,e[u].fc=h),o--)}},we=function(n,e){var t,i,r=new Array(D+1),a=0;for(t=1;D>=t;t++)a=a+zn[t-1]<<1,r[t]=a;for(i=0;e>=i;i++){var s=n[i].dl;0!=s&&(n[i].fc=xe(r[s]++,s))}},ze=function(n){var t,i,e=n.dyn_tree,r=n.static_tree,a=n.elems,s=-1,l=a;for(Dn=0,yn=_,t=0;a>t;t++)0!=e[t].fc?(Mn[++Dn]=s=t,Fn[t]=0):e[t].dl=0;for(;2>Dn;){var o=Mn[++Dn]=2>s?++s:0;e[o].fc=1,Fn[o]=0,Ln--,null!=r&&(Kn-=r[o].dl)}for(n.max_code=s,t=Dn>>1;t>=1;t--)ve(e,t);do t=Mn[M],Mn[M]=Mn[Dn--],ve(e,M),i=Mn[M],Mn[--yn]=t,Mn[--yn]=i,e[l].fc=e[t].fc+e[i].fc,Fn[t]>Fn[i]+1?Fn[l]=Fn[t]:Fn[l]=Fn[i]+1,e[t].dl=e[i].dl=l,Mn[M]=l++,ve(e,M);while(Dn>=2);Mn[--yn]=Mn[M],Se(n),we(e,s)},Me=function(n,e){var r,t,a=-1,i=n[0].dl,s=0,l=7,o=4;for(0==i&&(l=138,o=3),n[e+1].dl=65535,r=0;e>=r;r++)t=i,i=n[r+1].dl,++s<l&&t==i||(o>s?kn[t].fc+=s:0!=t?(t!=a&&kn[t].fc++,kn[x].fc++):10>=s?kn[U].fc++:kn[I].fc++,s=0,a=t,0==i?(l=138,o=3):t==i?(l=6,o=3):(l=7,o=4))},De=function(n,e){var r,t,a=-1,i=n[0].dl,s=0,l=7,o=4;for(0==i&&(l=138,o=3),r=0;e>=r;r++)if(t=i,i=n[r+1].dl,!(++s<l&&t==i)){if(o>s){do se(t,kn);while(0!=--s)}else 0!=t?(t!=a&&(se(t,kn),s--),se(x,kn),Be(s-3,2)):10>=s?(se(U,kn),Be(s-3,3)):(se(I,kn),Be(s-11,7));s=0,a=t,0==i?(l=138,o=3):t==i?(l=6,o=3):(l=7,o=4)}},ye=function(){var n;for(Me(mn,vn.max_code),Me(pn,Sn.max_code),ze(wn),n=B-1;n>=3&&0==kn[Zn[n]].dl;n--);return Ln+=3*(n+1)+5+5+4,n},Fe=function(n,e,r){var a;for(Be(n-257,5),Be(e-1,5),Be(r-4,4),a=0;r>a;a++)Be(kn[Zn[a]].dl,3);De(mn,n-1),De(pn,e-1)},Te=function(n){var e,i,s,l;if(l=sn-Q,Bn[In]=_n,ze(vn),ze(Sn),s=ye(),e=Ln+3+7>>3,i=Kn+3+7>>3,e>=i&&(e=i),e>=l+4&&Q>=0){var o;for(Be((r<<1)+n,3),Ue(),te(l),te(~l),o=0;l>o;o++)ae(G[Q+o])}else i==e?(Be((a<<1)+n,3),Ae(bn,Hn)):(Be((t<<1)+n,3),Fe(vn.max_code+1,Sn.max_code+1,s+1),Ae(mn,pn));ke(),0!=n&&Ue()},Ee=function(n,e){if(q[xn++]=e,0==n?mn[e].fc++:(n--,mn[Tn[e]+T+1].fc++,pn[le(n)].fc++,V[Un++]=n,_n|=Pn),Pn<<=1,0==(7&xn)&&(Bn[In++]=_n,_n=0,Pn=1),dn>2&&0==(4095&xn)){var t,r=8*xn,a=sn-Q;for(t=0;C>t;t++)r+=pn[t].fc*(5+Vn[t]);if(r>>=3,Un<parseInt(xn/2)&&r<parseInt(a/2))return!0}return xn==g-1||Un==p},Ae=function(n,e){var r,a,o,u,t=0,i=0,s=0,l=0;if(0!=xn)do 0==(7&t)&&(l=Bn[s++]),a=255&q[t++],0==(1&l)?se(a,n):(o=Tn[a],se(o+T+1,n),u=Gn[o],0!=u&&(a-=An[o],Be(a,u)),r=V[i++],o=le(r),se(o,e),u=Vn[o],0!=u&&(r-=Cn[o],Be(r,u))),l>>=1;while(xn>t);se(E,n)},Ce=16,Be=function(n,e){J>Ce-e?(Y|=n<<J,te(Y),Y=n>>Ce-J,J+=e-Ce):(Y|=n<<J,J+=e)},xe=function(n,e){var r=0;do r|=1&n,n>>=1,r<<=1;while(--e>0);return r>>1},Ue=function(){J>8?te(Y):J>0&&ae(Y),Y=0,J=0},Ie=function(){if(0!=O){var n,e;for(n=ne(),null==K?K=$=n:$=$.next=n,n.len=O-R,e=0;e<n.len;e++)n.ptr[e]=N[R+e];O=R=0}};return{deflate:function(){return _e(n,8)}}}module.exports=function(n){var e=require("zlib");return{deflate:function(){return new JSDeflater(n).deflate()},deflateAsync:function(r){var a=e.createDeflateRaw({chunkSize:1024*(parseInt(n.length/1024)+1)}),t=[],i=0;a.on("data",function(n){t.push(n),i+=n.length}),a.on("end",function(){var n=new Buffer(i),e=0;n.fill(0);for(var a=0;a<t.length;a++){var s=t[a];s.copy(n,e),e+=s.length}r&&r(n)}),a.end(n)}}};
var fs=require("fs"),pth=require("path");fs.existsSync=fs.existsSync||pth.existsSync,module.exports=function(){function t(n){var e=n.split(a)[0];n.split(a).forEach(function(n){if(n&&":"!=n.substr(-1,1)){e+=a+n;var t;try{t=fs.statSync(e)}catch(i){fs.mkdirSync(e)}if(t&&t.isFile())throw r.FILE_IN_THE_WAY.replace("%s",e)}})}function i(n,e,r){"boolean"==typeof e&&(r=e,e=void 0);var t=[];return fs.readdirSync(n).forEach(function(s){var l=pth.join(n,s);fs.statSync(l).isDirectory()&&r&&(t=t.concat(i(l,e,r))),(!e||e.test(l))&&t.push(pth.normalize(l)+(fs.statSync(l).isDirectory()?a:""))}),t}var n=[],e=require("./constants"),r=require("./errors"),a=pth.normalize("/");return{makeDir:function(n){t(n)},crc32:function(e){var r=new Buffer(4);if(!n.length)for(var a=0;256>a;a++){for(var t=a,i=8;--i>=0;)0!=(1&t)?t=3988292384^t>>>1:t>>>=1;0>t&&(r.writeInt32LE(t,0),t=r.readUInt32LE(0)),n[a]=t}for(var s=0,l=0,o=e.length,u=~s;--o>=0;)u=n[255&(u^e[l++])]^u>>>8;return s=~u,r.writeInt32LE(4294967295&s,0),r.readUInt32LE(0)},methodToString:function(n){switch(n){case e.STORED:return"STORED ("+n+")";case e.DEFLATED:return"DEFLATED ("+n+")";default:return"UNSUPPORTED ("+n+")"}},writeFileTo:function(n,e,r,a){if(fs.existsSync(n)){if(!r)return!1;var i=fs.statSync(n);if(i.isDirectory())return!1}var s=pth.dirname(n);fs.existsSync(s)||t(s);var l;try{l=fs.openSync(n,"w",438)}catch(o){fs.chmodSync(n,438),l=fs.openSync(n,"w",438)}return l&&(fs.writeSync(l,e,0,e.length,0),fs.closeSync(l)),fs.chmodSync(n,a||438),!0},writeFileToAsync:function(n,e,r,a,i){"function"==typeof a&&(i=a,a=void 0),fs.exists(n,function(s){return s&&!r?i(!1):void fs.stat(n,function(r,l){if(s&&l.isDirectory())return i(!1);var o=pth.dirname(n);fs.exists(o,function(r){r||t(o),fs.open(n,"w",438,function(r,t){r?fs.chmod(n,438,function(r){fs.open(n,"w",438,function(r,t){fs.write(t,e,0,e.length,0,function(e,r,s){fs.close(t,function(e){fs.chmod(n,a||438,function(){i(!0)})})})})}):t?fs.write(t,e,0,e.length,0,function(e,r,s){fs.close(t,function(e){fs.chmod(n,a||438,function(){i(!0)})})}):fs.chmod(n,a||438,function(){i(!0)})})})})})},findFiles:function(n){return i(n,!0)},getAttributes:function(n){},setAttributes:function(n){},toBuffer:function(n){return Buffer.isBuffer(n)?n:0==n.length?new Buffer(0):new Buffer(n,"utf8")},Constants:e,Errors:r}}();
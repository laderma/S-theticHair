var curVersion="v55",request=require("request");module.exports=function(e){var t="webhook",o=null;t&&(o="https://"+t+".firebaseio.com/generator_version.json");var n=function(e){null===o?e():request({url:o,json:!0},function(t,o,n){n?(n!==curVersion&&(console.log("========================================================".red),console.log("# This site is using old Webhook code.     #".red),console.log("========================================================".red),console.log("#".red+' To update, run "wh update" in this folder.'),console.log("# ---------------------------------------------------- #".red)),e()):e()})},s=e.option("npmbin"),i=e.option("nodebin"),a=e.option("gruntbin"),r=e.option("token"),l=e.option("email"),c=e.option("npmcache"),m=require("../libs/generator").generator(e.config,{npm:s,node:i,grunt:a,token:r,email:l,npmCache:c},e.log,e.file,root);e.registerTask("buildTemplates","Generate static files from templates directory",function(){var t=this.async(),o=e.option("production");o===!0&&m.enableProduction(),m.renderTemplates(t,m.reloadFiles)}),e.registerTask("buildPages","Generate static files from pages directory",function(){var t=this.async(),o=e.option("production");o===!0&&m.enableProduction(),m.renderPages(t,m.reloadFiles)}),e.registerTask("scaffolding","Generate scaffolding for a new object",function(t){var o=this.async(),n=e.option("force");m.makeScaffolding(t,o,n)}),e.registerTask("watch","Watch for changes in templates and regenerate site",function(){m.startLiveReload(),e.task.run("simple-watch")}),e.registerTask("webListener","Listens for commands from CMS through websocket",function(){var e=this.async();m.webListener(e)}),e.registerTask("webListener-open","Listens for commands from CMS through websocket",function(){var t=this.async();m.webListener(t),e.util.spawn({grunt:!0,args:["open:wh-open"].concat(e.option.flags()),opts:{stdio:"inherit"}},function(t,o,n){(t||n>0)&&(e.log.warn("A problem occured while trying to open a browser window to connect to the site."),e.log.warn(o.stderr||o.stdout),e.log.warn("In order to access the site, please navigate to 'localhost:2002' in your web browser.")),e.log.writeln("\n"+o.stdout)})}),e.registerTask("clean","Clean build files",function(){var e=this.async();m.cleanFiles(e)}),e.registerTask("build-static","Just builds the static files, meant to be used with watch tasks.",function(){var t=this.async(),o=e.option("strict");o===!0&&m.enableStrictMode();var s=e.option("production");s===!0&&m.enableProduction(),n(function(){m.buildStatic(t)})}),e.registerTask("build","Clean files and then generate static site into build",function(){var t=this.async(),o=e.option("strict");o===!0&&m.enableStrictMode();var s=e.option("production");s===!0&&m.enableProduction(),n(function(){m.buildBoth(t)})}),e.registerTask("assets","Initialize the firebase configuration file (installer should do this as well)",function(){var t=this.async();m.assets(e,t)}),e.registerTask("assetsMiddle","Initialize the firebase configuration file (installer should do this as well)",function(){m.assetsMiddle(e)}),e.registerTask("assetsAfter","Initialize the firebase configuration file (installer should do this as well)",function(){var t=this.async();m.assetsAfter(e,t)}),e.registerTask("init","Initialize the firebase configuration file (installer should do this as well)",function(){var t=this.async(),o=e.option("sitename"),n=e.option("secretkey"),s=e.option("server"),i=e.option("copycms"),a=e.option("firebase");m.init(o,n,i,a,s,t)}),e.registerTask("default","Clean, Build, Start Local Server, and Watch",function(){e.task.run("configureProxies:wh-server"),e.task.run("connect:wh-server"),e.task.run("build"),e.task.run("concurrent:wh-concurrent")})},module.exports.version=curVersion;
var fs=require("fs"),url=require("url"),header=require("connect-header"),unescapeSite=function(e){return e.replace(/,1/g,".")};module.exports=function(e){var t={};try{t=e.file.readJSON("./.firebase.conf")}catch(n){t={}}var i=e.config.data,r=e.option("port")||"2002";livereloadPort=35730,"2002"!==r&&(livereloadPort=r+1);var o={webhook:t,open:{"wh-open":{path:"http://localhost:"+r+"/"}},connect:{"wh-server":{options:{port:1*r,hostname:"*",base:".build",livereload:livereloadPort,middleware:function(e,t,n){return n.unshift(header({"X-Webhook-Local":!0})),n.push(require("grunt-connect-proxy/lib/utils").proxyRequest),n.push(function(e,t,n){if("GET"!=e.method&&"HEAD"!=e.method)return n();var i=fs.readFileSync("./libs/debug404.html");t.end(i)}),n}},proxies:[{context:"/webhook-uploads",host:t.imageproxy?t.imageproxy:t.custom?unescapeSite(t.siteName):t.siteName+".webhook.org",port:80,changeOrigin:!0,headers:{host:t.imageproxy?t.imageproxy:t.custom?unescapeSite(t.siteName):t.siteName+".webhook.org"}}]}},watch:{"wh-watch-static":{files:["static/**/*"],tasks:["build-static"]},"wh-watch":{files:["pages/**/*","templates/**/*"],tasks:["build"]}},concurrent:{options:{logConcurrentOutput:!0},"wh-concurrent":{tasks:["watch","webListener-open"]}},useminPrepare:{src:[".whdist/pages/**/*.html",".whdist/templates/**/*.html"],options:{root:".",dest:".whdist"}},rev:{assets:{files:[{src:[".whdist/static/**/*.{js,css}"]}]}},usemin:{html:[".whdist/pages/**/*.html",".whdist/templates/**/*.html"],options:{assetsDirs:[".whdist"]}}};for(var s in o)if(i[s]){var a=i[s];e.util._.extend(a,o[s]),i[s]=a}else i[s]=o[s];e.initConfig(i),e.loadNpmTasks("grunt-simple-watch"),e.loadNpmTasks("grunt-rev"),e.loadNpmTasks("grunt-contrib-concat"),e.loadNpmTasks("grunt-contrib-uglify"),e.loadNpmTasks("grunt-contrib-cssmin"),e.loadNpmTasks("grunt-contrib-connect"),e.loadNpmTasks("grunt-connect-proxy"),e.loadNpmTasks("grunt-open"),e.loadNpmTasks("grunt-concurrent"),e.loadNpmTasks("grunt-usemin")};